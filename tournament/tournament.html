<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chess Arena Pi â€“ Quick Match</title>
<style>
  body {
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: #222;
    color: white;
    flex-direction: column;
    position: relative;
    overflow: hidden;
  }

  /* Loader */
  .loader {
    position: relative;
    width: 120px;
    height: 120px;
    margin-bottom: 20px;
  }

  .pi-symbol {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 42px;
    color: gold;
    font-weight: bold;
    z-index: 2;
  }

  .orbit-dot {
    position: absolute;
    width: 10px;
    height: 10px;
    background: gold;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform-origin: center center;
    animation: orbit 4s linear infinite;
  }

  .orbit-dot:nth-child(1) { transform: rotate(0deg) translate(40px); animation-delay: 0s; }
  .orbit-dot:nth-child(2) { transform: rotate(45deg) translate(40px); animation-delay: -0.5s; }
  .orbit-dot:nth-child(3) { transform: rotate(90deg) translate(40px); animation-delay: -1s; }
  .orbit-dot:nth-child(4) { transform: rotate(135deg) translate(40px); animation-delay: -1.5s; }
  .orbit-dot:nth-child(5) { transform: rotate(180deg) translate(40px); animation-delay: -2s; }
  .orbit-dot:nth-child(6) { transform: rotate(225deg) translate(40px); animation-delay: -2.5s; }
  .orbit-dot:nth-child(7) { transform: rotate(270deg) translate(40px); animation-delay: -3s; }
  .orbit-dot:nth-child(8) { transform: rotate(315deg) translate(40px); animation-delay: -3.5s; }

  @keyframes orbit {
    from { transform: rotate(0deg) translate(40px); }
    to   { transform: rotate(360deg) translate(40px); }
  }

  .button-container {
    display: none;
    flex-direction: column;
    gap: 16px;
    width: 260px;
    margin-top: 20px;
    align-items: center;
  }

  button {
    padding: 14px;
    font-size: 16px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    background: #2196f3;
    color: white;
    transition: 0.3s;
    width: 100%;
  }

  button:hover {
    background: #0b79d0;
  }

  /* Modals */
  .modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    color: white;
    justify-content: center;
    align-items: center;
    z-index: 999;
    flex-direction: column;
    padding: 20px;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .modal.show { opacity: 1; }

  .modal-content {
    background: #333;
    padding: 20px;
    border-radius: 12px;
    width: 90%;
    max-width: 320px;
    display: flex;
    flex-direction: column;
    align-items: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
  }

  .modal-content input {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    border-radius: 6px;
    border: none;
  }

  .modal-content button {
    margin-top: 8px;
    width: 100%;
    font-size: 16px;
  }

  .watermark {
    position: fixed;
    bottom: 5px;
    right: 10px;
    font-size: 10px;
    color: rgba(255,255,255,0.3);
  }

</style>
</head>
<body>

<!-- Loader -->
<div id="loaderWrapper" style="display:flex; flex-direction:column; align-items:center;">
  <div class="loader">
    <div class="pi-symbol">Ï€</div>
    <div class="orbit-dot"></div>
    <div class="orbit-dot"></div>
    <div class="orbit-dot"></div>
    <div class="orbit-dot"></div>
    <div class="orbit-dot"></div>
    <div class="orbit-dot"></div>
    <div class="orbit-dot"></div>
    <div class="orbit-dot"></div>
  </div>
  <div class="sdk-text">Loading Pi Network SDK...</div>
</div>

<!-- Buttons -->
<div class="button-container" id="buttons">
  <button onclick="inviteMatch()">Â© Invite</button>
  <button onclick="randomMatch()">Â© Random</button>
  <button onclick="aiMatch()">Â© AI</button>
</div>

<!-- Invite Modal -->
<div class="modal" id="inviteModal">
  <div class="modal-content">
    <h3>Invite Player</h3>
    <input id="inviteeId" placeholder="Type invitee Pi ID">
    <button onclick="sendInvite()">Send Invite</button>
    <button onclick="closeModal('inviteModal')">Cancel</button>
  </div>
</div>

<!-- Invitee Confirmation Modal -->
<div class="modal" id="inviteeConfirmModal">
  <div class="modal-content">
    <p id="inviteeText"></p>
    <button onclick="acceptInvite()">Accept & Pay</button>
    <button onclick="closeModal('inviteeConfirmModal')">Decline</button>
  </div>
</div>

<!-- AI Modal -->
<div class="modal" id="aiModal">
  <div class="modal-content">
    <h3>AI Match</h3>
    <p>Tip the developer (min 0.1Ï€, max 10Ï€) or watch ad</p>
    <button onclick="tipAI()">ðŸ’° Tip Pi</button>
    <button onclick="watchAdAI()">ðŸŽ¥ Watch Ad</button>
    <button onclick="closeModal('aiModal')">Cancel</button>
  </div>
</div>

<div class="watermark">*Powered by PI NETWORK</div>

<script src="https://sdk.minepi.com/pi-sdk.js"></script>
<script>
  // Show buttons after loader
  setTimeout(() => {
    document.getElementById('loaderWrapper').style.display = 'none';
    document.getElementById('buttons').style.display = 'flex';
  }, 5000);

  // Initialize Pi SDK
  try {
    Pi.init({ version: "2.0", sandbox: true, appId: "chess-world-pi" });
  } catch(e){ console.warn("Pi SDK not loaded."); }

  // --- Modals ---
  function openModal(id){ 
    const m = document.getElementById(id); 
    m.style.display='flex'; 
    setTimeout(()=>m.classList.add('show'),10);
  }
  function closeModal(id){ 
    const m = document.getElementById(id); 
    m.classList.remove('show'); 
    setTimeout(()=>m.style.display='none',300);
  }

  // --- Invite ---
  let currentInvitee = "";
  function inviteMatch(){ openModal('inviteModal'); }
  function sendInvite(){
    const invitee = document.getElementById('inviteeId').value.trim();
    if(!invitee) return alert("Enter Pi ID");
    currentInvitee = invitee;
    closeModal('inviteModal');
    document.getElementById('inviteeText').innerText = "Invite from you to: "+invitee;
    openModal('inviteeConfirmModal');
  }
  async function acceptInvite(){
    closeModal('inviteeConfirmModal');
    try{
      await Pi.createPayment({amount:0.25, memo:"Invite Match", metadata:{mode:"invite", invitee:currentInvitee}});
      window.location.href = "game.html?mode=invite&with="+encodeURIComponent(currentInvitee);
    }catch(e){ console.error(e); alert("Payment failed"); }
  }

  // --- Random ---
  async function randomMatch(){
    try{
      await Pi.createPayment({amount:0.25, memo:"Random Match", metadata:{mode:"random"}});
      window.location.href="game.html?mode=random";
    }catch(e){ console.error(e); alert("Payment failed"); }
  }

  // --- AI ---
  function aiMatch(){ openModal('aiModal'); }
  async function tipAI(){
    let amount = prompt("Enter tip amount (0.1Ï€ â€“ 10Ï€):", "0.1");
    if(!amount) return;
    amount = parseFloat(amount);
    if(amount < 0.1 || amount > 10) return alert("Tip must be between 0.1Ï€ and 10Ï€");
    try{
      await Pi.createPayment({amount:amount, memo:"Tip AI", metadata:{mode:"ai"}});
      window.location.href="ai.html?method=tip&amount="+amount;
    }catch(e){ console.error(e); alert("Tip failed"); }
  }
  function watchAdAI(){
    alert("ðŸŽ¥ Watching Ad...");
    setTimeout(()=>{
      alert("âœ… Ad finished. Loading AI match...");
      window.location.href="ai.html?method=ad";
    },5000);
  }
</script>

</body>
</html>
