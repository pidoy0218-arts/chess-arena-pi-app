<html lang="en">
<head>
<meta charset="UTF-8" />
<title>CHESS ARENA for PI — Quick (Multiplayer-ready)</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{
    --bg:#0f1720; --fg:#eef2f7; --accent:#f3c24f; --warn:#ff5252;
    --light:#f4ead0; --dark:#8aa46b;
    --hint:#5ac8fa; --sel:#ffd54f;
  }
  body{ margin:0; background:var(--bg); color:var(--fg); font-family:system-ui,Arial,Segoe UI,sans-serif; display:flex; flex-direction:column; align-items:center; padding:12px; min-height:100vh; }
  h1{margin:10px 0 2px; font-size:20px}
  .sub{opacity:.75; font-size:13px; margin-bottom:8px}
  .container{ width:100%; max-width:1000px; display:flex; gap:16px; align-items:flex-start; justify-content:center; }
  /* Board same size as your base */
  #board{ display:grid; grid-template-columns:repeat(8, min(10.5vw,66px)); grid-template-rows:repeat(8, min(10.5vw,66px)); border:6px solid #2b1b12; border-radius:10px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,.6); user-select:none; background:linear-gradient(180deg,#e9dbc0,#d8c8a0); }
  .sq{ display:flex; align-items:center; justify-content:center; font-size:min(8vw,46px); cursor:pointer; }
  .sq.light{ background:linear-gradient(180deg,var(--light),#efe0bb); }
  .sq.dark{ background:linear-gradient(180deg,#c7d99b,var(--dark)); }
  .piece{ display:inline-flex; align-items:center; justify-content:center; width:78%; height:78%; border-radius:50%; box-shadow:0 6px 18px rgba(0,0,0,0.35); }
  .piece.white{ background:linear-gradient(180deg,#fff9e6,#f3e0b2); color:#2c2200; font-weight:800 }
  .piece.black{ background:linear-gradient(180deg,#2b2b2b,#0a0a0a); color:#fff }
  .sq.sel{ outline:3px solid var(--sel); outline-offset:-3px }
  .sq.hint::after{ content:""; width:22%; height:22%; border-radius:50%; background:var(--hint); opacity:.9 }
  .sq.cap{ box-shadow: inset 0 0 0 4px var(--warn) }
  /* Side panel */
  .side{ width:320px; display:flex; flex-direction:column; gap:12px }
  .panel{ background:#111; border-radius:10px; padding:12px; border:1px solid rgba(255,255,255,0.02) }
  .row{ display:flex; justify-content:space-between; align-items:center }
  .status{ font-weight:700 }
  .moves{ font-family:ui-monospace,monospace; font-size:13px; max-height:260px; overflow:auto }
  .controls{ display:flex; gap:8px; justify-content:flex-end }
  .btn{ padding:8px 12px; border-radius:8px; border:none; cursor:pointer; font-weight:700 }
  .btn.primary{ background:var(--accent); color:#111 }
  .btn.danger{ background:var(--warn); color:#111 }
  .pill{ padding:6px 10px; border-radius:999px; background:rgba(255,255,255,0.03); }
  /* top SDK / players */
  .topbar{ width:100%; max-width:1000px; display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:8px }
  .sdk{ display:flex; gap:8px; align-items:center }
  select{ padding:8px 10px; border-radius:8px; background:#0f1720; color:var(--fg); border:1px solid rgba(255,255,255,0.03) }
  .player-info{ display:flex; gap:10px; align-items:center }
  .player-id{ font-size:13px; opacity:.9 }
  .timer{ font-weight:800; font-size:14px; padding:6px 10px; border-radius:8px; background:rgba(255,255,255,0.03) }
  /* modal */
  .modal{ position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; z-index:20 }
  .modal.show{ display:flex }
  .card{ background:#141414; padding:12px; border-radius:10px }
  @media (max-width:820px){ .container{ flex-direction:column; align-items:center } .side{ width:95% } }
</style>
</head>
<body>
  <h1>♞ CHESS ARENA for PI</h1>
  <div class="sub">FIDE-legal engine • 60s blitz (resets on move) • 15s warning • Promotion • Check/Checkmate</div>

  <div class="topbar">
    <div class="sdk">
      <label style="opacity:.85">Sign in:</label>
      <select id="sdkSelect" aria-label="SDK">
        <option value="" disabled selected>Choose</option>
        <option value="pi">Pi SDK (placeholder)</option>
        <option value="guest">Guest</option>
        <option value="mock">Local Mock</option>
      </select>
      <div style="width:10px"></div>
      <div class="player-info">
        <div class="player-id" id="whiteId">White: —</div>
        <div class="player-id" id="blackId">Black: —</div>
      </div>
    </div>
    <div class="timer pill" id="moveTimer">60s</div>
  </div>

  <div class="container">
    <div id="board" aria-label="chessboard"></div>

    <div class="side">
      <div class="panel">
        <div class="row"><div class="status" id="status">White to move</div><div class="pill" id="incheck" style="display:none">Check!</div></div>
        <div style="margin-top:8px" class="row tiny"><div>Castling: <span id="cr">KQkq</span></div><div>EP: <span id="ep">—</span></div></div>
      </div>

      <div class="panel">
        <div class="row"><div><b>Move List</b></div></div>
        <div id="moves" class="moves"></div>
      </div>

      <div class="panel controls">
        <button class="btn" id="btnDraw">Offer Draw</button>
        <button class="btn primary" id="btnRematch">Rematch</button>
        <button class="btn danger" id="btnResign">Resign</button>
      </div>
    </div>
  </div>

  <!-- Promotion modal -->
  <div id="promo" class="modal" role="dialog" aria-modal="true"><div class="card"><div style="font-weight:700">Promote pawn to:</div><div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:10px"><button class="pick" data-piece="q">♛</button><button class="pick" data-piece="r">♜</button><button class="pick" data-piece="b">♝</button><button class="pick" data-piece="n">♞</button></div></div></div>

  <!-- Confetti -->
  <canvas id="fx"></canvas>

<script>
/* ------------------ SDK / player setup ------------------ */
const sdkSelect = document.getElementById('sdkSelect');
const whiteIdEl = document.getElementById('whiteId');
const blackIdEl = document.getElementById('blackId');
let localPlayer = { id:null, name:null, color:'w' };

function genId(prefix='p'){ return prefix+Math.random().toString(36).slice(2,8); }
function initSDK(mode){
  if(mode==='pi') return Promise.resolve({ ok:true, playerId:genId('pi_'), playerName:'PiUser_'+Math.floor(Math.random()*900+100) });
  if(mode==='mock') return Promise.resolve({ ok:true, playerId:genId('mock_'), playerName:'LocalDev' });
  return Promise.resolve({ ok:true, playerId:genId('gst_'), playerName:'Guest' });
}

sdkSelect.addEventListener('change', async ()=>{
  const mode = sdkSelect.value;
  const r = await initSDK(mode);
  localPlayer.id = r.playerId; localPlayer.name = r.playerName; localPlayer.color = 'w';
  whiteIdEl.textContent = `White: ${localPlayer.name} (${localPlayer.id})`;
  blackIdEl.textContent = `Black: Waiting...`;
  startGame();
});

/* ------------------ Sound (improved) ------------------ */
const SND = (()=>{ let ctx; function tone(freq,dur=0.08,type='sine',pan=0){ try{ ctx = ctx || new (window.AudioContext||window.webkitAudioContext)(); const o=ctx.createOscillator(), g=ctx.createGain(); o.type=type; o.frequency.value=freq; g.gain.value=0.08; o.connect(g); g.connect(ctx.destination); o.start(); o.stop(ctx.currentTime+dur); }catch(e){} }
  return { move:()=>tone(720,0.06,'triangle'), capture:()=>tone(220,0.06,'sawtooth'), check:()=>tone(980,0.12,'square'), win:()=>[880,988,1175].forEach((f,i)=>setTimeout(()=>tone(f,0.12,'sine'),i*130)) };
})();

/* ------------------ Confetti ------------------ */
const Confetti=(function(){const c=document.getElementById('fx'),x=c.getContext('2d');let parts=[],run=false,w=0,h=0;function resize(){w=c.width=innerWidth;h=c.height=innerHeight;}addEventListener('resize',resize);resize();function burst(n=120){parts=[];for(let i=0;i<n;i++){parts.push({x:w/2,y:h*0.25,vx:(Math.random()*2-1)*6,vy:Math.random()*-5-2,g:Math.random()*0.15+0.18,s:Math.random()*6+3,a:Math.random()*Math.PI,col:`hsl(${Math.random()*360},90%,60%)`});}if(!run){run=true;requestAnimationFrame(loop);}}function loop(){x.clearRect(0,0,w,h);for(const p of parts){p.vy+=p.g;p.x+=p.vx;p.y+=p.vy;p.a+=0.2;x.save();x.translate(p.x,p.y);x.rotate(p.a);x.fillStyle=p.col;x.fillRect(-p.s/2,-p.s/2,p.s,p.s);x.restore();}parts=parts.filter(p=>p.y<h+30);if(parts.length){requestAnimationFrame(loop);}else{run=false;}}return{burst};})();

/* ------------------ Chess core (your working base) ------------------ */
const U={inBounds:(r,c)=>r>=0&&r<8&&c>=0&&c<8,clone:(o)=>JSON.parse(JSON.stringify(o)),toAlg:(r,c)=>"abcdefgh"[c]+(8-r),fromAlg:(a)=>({r:8-parseInt(a[1],10),c:"abcdefgh".indexOf(a[0])})};
const START=[ ["r","n","b","q","k","b","n","r"],["p","p","p","p","p","p","p","p"],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["P","P","P","P","P","P","P","P"],["R","N","B","Q","K","B","N","R"] ];
let state={ board:U.clone(START), side:'w', castling:{wk:true,wq:true,bk:true,bq:true}, ep:null, half:0, full:1, hist:[] };
function isWhite(p){return p&&p===p.toUpperCase();} function isBlack(p){return p&&p===p.toLowerCase();} function sidePiece(p,side){return side==='w'?isWhite(p):isBlack(p);} function other(side){return side==='w'?'b':'w';}
function kingPos(board,side){const K=side==='w'?'K':'k';for(let r=0;r<8;r++)for(let c=0;c<8;c++)if(board[r][c]===K)return{id:r,c};return null;}
function attacked(board,side,r,c){const pawnDir=side==='w'?-1:1;const pawn=side==='w'?'P':'p';for(const dc of[-1,1]){const rr=r+pawnDir,cc=c+dc;if(U.inBounds(rr,cc)&&board[rr][cc]===pawn)return true;}const N=side==='w'?'N':'n';for(const[dr,dc]of[[2,1],[1,2],[-1,2],[-2,1],[-2,-1],[-1,-2],[1,-2],[2,-1]]){const rr=r+dr,cc=c+dc;if(U.inBounds(rr,cc)&&board[rr][cc]===N)return true;}const B=side==='w'?'B':'b',R=side==='w'?'R':'r',Q=side==='w'?'Q':'q';for(const[dr,dc]of[[1,1],[1,-1],[-1,1],[-1,-1]]){let rr=r+dr,cc=c+dc;while(U.inBounds(rr,cc)){const p=board[rr][cc];if(p){if(p===B||p===Q)return true;break;}rr+=dr;cc+=dc;}}for(const[dr,dc]of[[1,0],[-1,0],[0,1],[0,-1]]){let rr=r+dr,cc=c+dc;while(U.inBounds(rr,cc)){const p=board[rr][cc];if(p){if(p===R||p===Q)return true;break;}rr+=dr;cc+=dc;}}const K=side==='w'?'K':'k';for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){if(!dr&&!dc)continue;const rr=r+dr,cc=c+dc;if(U.inBounds(rr,cc)&&board[rr][cc]===K)return true;}return false;}

function legalMoves(state){const moves=[];const{board,side}=state;const add=(m)=>moves.push(m);for(let r=0;r<8;r++){for(let c=0;c<8;c++){const p=board[r][c];if(!p||!sidePiece(p,side))continue;const isW=side==='w';switch(p.toLowerCase()){case'p':{const dir=isW?-1:1;const startRank=isW?6:1;const promoRank=isW?0:7;const r1=r+dir;if(U.inBounds(r1,c)&&!board[r1][c]){if(r1===promoRank)add({from:{r,c},to:{r:r1,c},piece:p,promoChoices:true});else add({from:{r,c},to:{r:r1,c},piece:p});if(r===startRank){const r2=r+2*dir;if(!board[r2][c])add({from:{r,c},to:{r:r2,c},piece:p,epSet:U.toAlg(r1,c)});}}for(const dc of[-1,1]){const cc=c+dc,rr=r+dir;if(!U.inBounds(rr,cc))continue;const target=board[rr][cc];if(target&&((isW&&isBlack(target))||(!isW&&isWhite(target)))){if(rr===promoRank)add({from:{r,c},to:{r:rr,c:cc},piece:p,capture:true,promoChoices:true});else add({from:{r,c},to:{r:rr,c:cc},piece:p,capture:true});}}if(state.ep){const{r:er,c:ec}=U.fromAlg(state.ep);if(er===r+dir&&Math.abs(ec-c)===1){if(ec===c-1||ec===c+1){add({from:{r,c},to:{r:er,c:ec},piece:p,ep:true,capture:true});}}}}break;case'n':{for(const[dr,dc]of[[2,1],[1,2],[-1,2],[-2,1],[-2,-1],[-1,-2],[1,-2],[2,-1]]){const rr=r+dr,cc=c+dc;if(!U.inBounds(rr,cc))continue;const t=board[rr][cc];if(!t||(isW?isBlack(t):isWhite(t)))add({from:{r,c},to:{r:rr,c:cc},piece:p,capture:!!t});}}break;case'b':{for(const[dr,dc]of[[1,1],[1,-1],[-1,1],[-1,-1]]){let rr=r+dr,cc=c+dc;while(U.inBounds(rr,cc)){const t=board[rr][cc];if(!t)add({from:{r,c},to:{r:rr,c:cc},piece:p});else{if(isW?isBlack(t):isWhite(t))add({from:{r,c},to:{r:rr,c:cc},piece:p,capture:true});break;}rr+=dr;cc+=dc;}}}break;case'r':{for(const[dr,dc]of[[1,0],[-1,0],[0,1],[0,-1]]){let rr=r+dr,cc=c+dc;while(U.inBounds(rr,cc)){const t=board[rr][cc];if(!t)add({from:{r,c},to:{r:rr,c:cc},piece:p});else{if(isW?isBlack(t):isWhite(t))add({from:{r,c},to:{r:rr,c:cc},piece:p,capture:true});break;}rr+=dr;cc+=dc;}}}break;case'q':{for(const[dr,dc]of[[1,1],[1,-1],[-1,1],[-1,-1],[1,0],[-1,0],[0,1],[0,-1]]){let rr=r+dr,cc=c+dc;while(U.inBounds(rr,cc)){const t=board[rr][cc];if(!t)add({from:{r,c},to:{r:rr,c:cc},piece:p});else{if(isW?isBlack(t):isWhite(t))add({from:{r,c},to:{r:rr,c:cc},piece:p,capture:true});break;}rr+=dr;cc+=dc;}}}break;case'k':{for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){if(!dr&&!dc)continue;const rr=r+dr,cc=c+dc;if(!U.inBounds(rr,cc))continue;const t=board[rr][cc];if(!t||(isW?isBlack(t):isWhite(t)))add({from:{r,c},to:{r:rr,c:cc},piece:p,capture:!!t});}const inChk=attacked(board,other(side),r,c);if(!inChk){if(side==='w'){if(state.castling.wk&&!board[7][5]&&!board[7][6]&&!attacked(board,'b',7,5)&&!attacked(board,'b',7,6))add({from:{r,c},to:{r:7,c:6},piece:p,castle:'K'});if(state.castling.wq&&!board[7][3]&&!board[7][2]&&!board[7][1]&&!attacked(board,'b',7,3)&&!attacked(board,'b',7,2))add({from:{r,c},to:{r:7,c:2},piece:p,castle:'Q'});}else{if(state.castling.bk&&!board[0][5]&&!board[0][6]&&!attacked(board,'w',0,5)&&!attacked(board,'w',0,6))add({from:{r,c},to:{r:0,c:6},piece:p,castle:'k'});if(state.castling.bq&&!board[0][3]&&!board[0][2]&&!board[0][1]&&!attacked(board,'w',0,3)&&!attacked(board,'w',0,2))add({from:{r,c},to:{r:0,c:2},piece:p,castle:'q'});}}break;}}}const legal=[];for(const m of moves){const st=U.clone(state);makeMove(st,m,true);const kp=kingPos(st.board,st.side==='w'?'b':'w');const inCheck=attacked(st.board,st.side,kp.r,kp.c);if(!inCheck)legal.push(m);}return legal;}

function makeMove(state,m,simulate=false,promoChoice=null){const B=state.board;const from=m.from,to=m.to;const piece=B[from.r][from.c];const side=state.side;const isW=side==='w';const rec={board:U.clone(B),side:state.side,castling:U.clone(state.castling),ep:state.ep,half:state.half,full:state.full,san:""};state.ep=null;if(m.ep){const dir=isW?1:-1;B[to.r+dir][to.c]='';}if(m.castle){if(m.castle==='K'){B[7][5]=B[7][7];B[7][7]='';}else if(m.castle==='Q'){B[7][3]=B[7][0];B[7][0]='';}else if(m.castle==='k'){B[0][5]=B[0][7];B[0][7]='';}else if(m.castle==='q'){B[0][3]=B[0][0];B[0][0]='';}}B[to.r][to.c]=piece;B[from.r][from.c]='';if(m.epSet){state.ep=m.epSet;}if(m.promoChoices){if(!promoChoice&&!simulate){pendingPromotion={move:m,rec};openPromotion(isW);return null;}const promoted=(isW?promoChoice.toUpperCase():promoChoice.toLowerCase());B[to.r][to.c]=promoted;}const moved=piece.toLowerCase();const fromAlg=U.toAlg(from.r,from.c),toAlg=U.toAlg(to.r,to.c);if(piece==='K'){state.castling.wk=false;state.castling.wq=false;}if(piece==='k'){state.castling.bk=false;state.castling.bq=false;}if(fromAlg==='h1'||toAlg==='h1')state.castling.wk=false;if(fromAlg==='a1'||toAlg==='a1')state.castling.wq=false;if(fromAlg==='h8'||toAlg==='h8')state.castling.bk=false;if(fromAlg==='a8'||toAlg==='a8')state.castling.bq=false;if(moved==='p'||m.capture)state.half=0;else state.half++;if(side==='b')state.full++;state.side=other(side);if(!simulate)state.hist.push(rec);return true;}

/* ------------------ UI glue ------------------ */
const PIECES={r:'♜',n:'♞',b:'♝',q:'♛',k:'♚',p:'♟',R:'♖',N:'♘',B:'♗',Q:'♕',K:'♔',P:'♙'};const boardEl=document.getElementById('board');const statusEl=document.getElementById('status');const incheckEl=document.getElementById('incheck');const crEl=document.getElementById('cr');const epEl=document.getElementById('ep');const movesEl=document.getElementById('moves');let selected=null;let legal=[];let flipped=false;let pendingPromotion=null;

function render(){boardEl.innerHTML='';const mapIndex=(i)=>flipped?63-i:i;for(let r=0;r<8;r++){for(let c=0;c<8;c++){const i=r*8+c,idx=mapIndex(i);const rr=Math.floor(idx/8),cc=idx%8;const sq=document.createElement('div');sq.className=`sq ${((r+c)%2)?'dark':'light'}`;sq.dataset.r=rr;sq.dataset.c=cc;const p=state.board[rr][cc];if(p){const span=document.createElement('div');span.className=`piece ${isWhite(p)?'white':'black'}`;span.textContent=PIECES[p];sq.appendChild(span);}if(selected&&selected.r===rr&&selected.c===cc)sq.classList.add('sel');for(const m of legal){if(m.to.r===rr&&m.to.c===cc){ if(m.capture) sq.classList.add('cap'); else sq.classList.add('hint'); }}boardEl.appendChild(sq);}}const kp=kingPos(state.board,state.side);const chk=attacked(state.board,other(state.side),kp.r,kp.c);incheckEl.style.display=chk?'':'none';statusEl.textContent=(state.side==='w'?'White':'Black')+' to move';const cr=`${state.castling.wk?'K':''}${state.castling.wq?'Q':''}${state.castling.bk?'k':''}${state.castling.bq?'q':''}`||'—';crEl.textContent=cr;epEl.textContent=state.ep||'—';const lm=legalMoves(state);if(!lm.length){if(chk){statusEl.textContent=(other(state.side)==='w'?'White':'Black')+' wins by checkmate';SND.win();Confetti.burst(140);endGame((other(state.side)==='w'?'White':'Black')+' wins by checkmate');}else{statusEl.textContent='Draw by stalemate';SND.check();endGame('Draw by stalemate');}}
}

boardEl.addEventListener('click',e=>{const sq=e.target.closest('.sq');if(!sq)return;const rr=+sq.dataset.r,cc=+sq.dataset.c;squareClick(rr,cc);});

function squareClick(rr,cc){const p=state.board[rr][cc];if(selected){const mv=legal.find(m=>m.to.r===rr&&m.to.c===cc);if(mv){const wasCapture=!!mv.capture;const ok=makeMove(state,mv);if(ok){logMove(mv);render();wasCapture?SND.capture():SND.move();const kp=kingPos(state.board,state.side);if(attacked(state.board,other(state.side),kp.r,kp.c))SND.check();resetMoveTimer();}selected=null;legal=[];return;}if(p&&sidePiece(p,state.side)){selected={r:rr,c:cc};legal=legalMoves(state).filter(m=>m.from.r===rr&&m.from.c===cc);}else{selected=null;legal=[];}}else{if(p&&sidePiece(p,state.side)){selected={r:rr,c:cc};legal=legalMoves(state).filter(m=>m.from.r===rr&&m.from.c===cc);} }render();}

/* ------------------ controls: resign/draw/rematch ------------------ */
const btnResign=document.getElementById('btnResign');const btnDraw=document.getElementById('btnDraw');const btnRematch=document.getElementById('btnRematch');
btnResign.addEventListener('click',()=>{const loser=(state.side==='w'?'White':'Black');endGame(loser+' resigned');});
btnDraw.addEventListener('click',()=>{endGame('Draw agreed');});
btnRematch.addEventListener('click',()=>{setTimeout(()=>{resetGame();},300);} );

/* ------------------ logging / move list ------------------ */
function logMove(m){const from=U.toAlg(m.from.r,m.from.c),to=U.toAlg(m.to.r,m.to.c);const cap=m.capture?'x':'–';const note=`${from}${cap}${to}${m.castle? ' (O-O'+(m.castle.toLowerCase()==='q'?'-O':'')+')':''}${m.ep?' e.p.':''}${m.promoChoices?'=Q':''}`;const row=document.createElement('div');row.textContent=note;movesEl.appendChild(row);movesEl.scrollTop=movesEl.scrollHeight;}

/* ------------------ promotion ------------------ */
const promoEl=document.getElementById('promo');promoEl.addEventListener('click',e=>{if(!e.target.classList.contains('pick'))return;const code=e.target.dataset.piece;choosePromotion(code);});function openPromotion(white){promoEl.classList.add('show');promoEl.querySelectorAll('.pick').forEach(btn=>{btn.style.color=white?'#b8860b':'#000';btn.style.textShadow=white?'2px 2px 0 #000':'none';});}function choosePromotion(code){promoEl.classList.remove('show');const {move,rec}=pendingPromotion;state.board=rec.board;state.side=rec.side;state.castling=rec.castling;state.ep=rec.ep;state.half=rec.half;state.full=rec.full;pendingPromotion=null;makeMove(state,move,false,code);logMove({...move,promo:true});render();SND.move();}

/* ------------------ move timer (60s, 15s warning) ------------------ */
let moveTimer=60;let moveInterval=null;const moveTimerEl=document.getElementById('moveTimer');
function startMoveTimer(){ clearInterval(moveInterval); moveTimer=60; updateTimerUI(); moveInterval=setInterval(()=>{ moveTimer--; if(moveTimer===15) tickWarning(); updateTimerUI(); if(moveTimer<=0){ clearInterval(moveInterval); const loser=(state.side==='w'?'White':'Black'); endGame(loser+' lost on time'); } },1000); }
function resetMoveTimer(){ startMoveTimer(); }
function updateTimerUI(){ moveTimerEl.textContent = (moveTimer<=15? '⚠ ' : '') + moveTimer + 's'; if(moveTimer<=15) moveTimerEl.style.background='rgba(255,200,0,0.12)'; else moveTimerEl.style.background=''; }
function tickWarning(){ try{ SND.check(); }catch(e){} }

/* ------------------ endgame flow: delay 5s then reset + GitHub placeholder recording ------------------ */
let gameOver=false;
function endGame(resultText){ if(gameOver) return; gameOver=true; statusEl.textContent = resultText; setTimeout(()=>{ // record result to GitHub placeholder
    submitResultToGitHub({ result: resultText, white: whiteIdEl.textContent, black: blackIdEl.textContent, time: (new Date()).toISOString() });
    // after recording, reset board to waiting state
    resetGame();
  }, 5000); }

function resetGame(){ state={ board:U.clone(START), side:'w', castling:{wk:true,wq:true,bk:true,bq:true}, ep:null, half:0, full:1, hist:[] }; selected=null; legal=[]; pendingPromotion=null; movesEl.innerHTML=''; gameOver=false; render(); startMoveTimer(); }

/* ------------------ GitHub placeholder (record win/lose) ------------------ */
function submitResultToGitHub(payload){
  // Placeholder: replace with real fetch to your server/GitHub action.
  console.log('Submitting game result to GitHub placeholder:', payload);
  // Example: fetch('https://your-server.example.com/record', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}).then(...)
}

/* ------------------ start / bootstrap ------------------ */
function startGame(){ render(); startMoveTimer(); }

// auto-render initial board but wait for SDK selection if you want
render();
</script>
</body>
</html>
<!DOCTYPE html>

