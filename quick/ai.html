<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Chess Arena Pi — Player vs AI</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  body { background:#111; color:#eee; margin:0; font-family:sans-serif; display:flex; flex-direction:column; align-items:center; }
  #board { display:grid; grid-template-columns:repeat(8,60px); grid-template-rows:repeat(8,60px); border:4px solid #333; }
  .sq { width:60px; height:60px; display:flex; align-items:center; justify-content:center; font-size:42px; cursor:pointer; }
  .light { background:#eee; }
  .dark { background:#769656; }
  .piece.white { color:khaki; text-shadow:0 0 3px #000; }
  .piece.black { color:#000; text-shadow:0 0 3px #fff; }
  .selected { outline:3px solid yellow; }
  #topbar { margin:10px; display:flex; gap:10px; align-items:center; }
  button { padding:6px 12px; border:none; border-radius:6px; background:#444; color:#eee; cursor:pointer; }
  button:hover { background:#666; }
</style>
</head>
<body>
<div id="topbar">
  <h2>Chess Arena Pi — Player vs AI</h2>
  <button onclick="flipBoard()">Flip Board</button>
</div>
<div id="info"></div>
<div id="board"></div>

<!-- chess.js rules engine -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.13.4/chess.min.js"></script>
<script>
const boardEl = document.getElementById("board");
const infoEl = document.getElementById("info");

const PIECES = {
  "p":"♟","r":"♜","n":"♞","b":"♝","q":"♛","k":"♚",
  "P":"♙","R":"♖","N":"♘","B":"♗","Q":"♕","K":"♔"
};

let game = new Chess();
let flipped = false;
let humanColor = Math.random() < 0.5 ? "w" : "b";
let aiColor = humanColor === "w" ? "b" : "w";
let selected = null;

infoEl.textContent = `You are ${humanColor==="w" ? "White" : "Black"}. AI is ${aiColor==="w" ? "White" : "Black"}.`;

function render(){
  boardEl.innerHTML = '';
  let squares = game.board();
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      const idx = flipped ? (63 - (r*8 + c)) : (r*8 + c);
      const rr = Math.floor(idx/8), cc = idx%8;
      const sq = document.createElement("div");
      sq.className = `sq ${((rr+cc)%2) ? "dark" : "light"}`;
      let piece = squares[rr][cc];
      if(selected && selected[0]===rr && selected[1]===cc){
        sq.classList.add("selected");
      }
      if(piece){
        const sp = document.createElement("span");
        sp.textContent = PIECES[piece.color==="w" ? piece.type.toUpperCase() : piece.type];
        sp.className = `piece ${piece.color==="w" ? "white" : "black"}`;
        sq.appendChild(sp);
      }
      sq.onclick = ()=> handleClick(rr,cc);
      boardEl.appendChild(sq);
    }
  }
}

function handleClick(r,c){
  if(game.turn() !== humanColor) return; // wait AI turn
  const squares = game.board();
  let piece = squares[r][c];

  if(selected){
    let [sr,sc] = selected;
    let from = String.fromCharCode(97+sc) + (8-sr);
    let to = String.fromCharCode(97+c) + (8-r);

    // try promotion if pawn reaches end
    let move = game.move({from,to,promotion:'q'});
    if(move){
      selected = null;
      render();
      setTimeout(aiMove,500);
      return;
    } else {
      selected = null;
    }
  } else {
    if(piece && piece.color === humanColor){
      selected = [r,c];
    }
  }
  render();
}

function aiMove(){
  let moves = game.moves({verbose:true});
  if(moves.length===0) return;
  let move = moves[Math.floor(Math.random()*moves.length)];
  game.move(move);
  render();
}

function flipBoard(){
  flipped = !flipped;
  render();
}

// init
render();
if(game.turn()===aiColor){
  setTimeout(aiMove,500);
}
</script>
</body>
</html>
