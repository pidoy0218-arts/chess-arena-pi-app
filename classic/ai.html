<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>CHESS ARENA for PI — Classic Play vs. AI</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
:root{--bg:#111;--fg:#eee;--light:#f0f0f0;--dark:#9fa8da;--sel:#ffcc00;--hint:#5ac8fa;--accent:gold;--warn:#ff5252;}
body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Arial;display:flex;flex-direction:column;align-items:center;padding:16px;}
h1{margin:6px 0 2px;font-size:20px}.sub{opacity:.75;font-size:12px;margin-bottom:8px}
.wrap{display:flex;gap:18px;flex-wrap:wrap;align-items:flex-start;justify-content:center;width:100%;max-width:1100px}
#board{display:grid;grid-template-columns:repeat(8,min(10.5vw,66px));grid-template-rows:repeat(8,min(10.5vw,66px));border:6px solid #333;border-radius:10px;overflow:hidden;box-shadow:0 8px 24px rgba(0,0,0,.45);}
.sq{display:flex;align-items:center;justify-content:center;font-size:min(8vw,50px);cursor:pointer;}
.sq.light{background:var(--light);}
.sq.dark{background:var(--dark);}
.piece.white{color:#c7b77f;font-weight:900;text-shadow:1px 1px 0 #000;}
.piece.black{color:#000;font-weight:900;}
.sq.sel{outline:3px solid var(--sel);outline-offset:-3px;}
.sq.hint::after{content:"";width:22%;height:22%;border-radius:50%;background:var(--hint);opacity:.85;display:block;}
.sq.cap{box-shadow: inset 0 0 0 4px var(--warn);}
.side{min-width:260px;max-width:360px;display:flex;flex-direction:column;gap:10px;}
.panel{background:#1b1b1b;border:1px solid #2b2b2b;border-radius:10px;padding:10px 12px;}
.row{display:flex;justify-content:space-between;align-items:center;gap:10px;}
.btn{padding:10px 12px;border-radius:8px;border:0;color:#fff;background:var(--accent);font-weight:700;cursor:pointer;}
.tiny{font-size:12px;opacity:.8;}
.moves{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:13px;line-height:1.45;max-height:260px;overflow:auto;}
#fx{position:fixed;inset:0;pointer-events:none;z-index:9;}
.controls{display:flex;gap:8px;align-items:center;}
</style>
</head>
<body>
<h1>♞ CHESS ARENA for PI</h1>
<div class="sub">Classic Match: Player vs. AI</div>
<div class="wrap">
  <div id="board" aria-label="chessboard"></div>
  <div class="side">
    <div class="panel">
      <div class="row">
        <div style="font-weight:bold;">You (White)</div>
        <div>vs.</div>
        <div style="font-weight:bold;" id="aiPlayer">AI</div>
      </div>
      <div class="row" style="margin-top:8px">
        <div id="status" style="font-weight:700">White to move</div>
        <div id="incheck" style="display:none;padding:4px 8px;border-radius:8px;background:#2b2b2b">Check!</div>
      </div>
      <div class="row tiny">
        <div>Castling: <span id="cr">KQkq</span></div>
        <div>En Passant: <span id="ep">---</span></div>
      </div>
      <div class="row tiny" style="margin-top:8px">
        <label for="aiLevel">AI Difficulty:</label>
        <select id="aiLevel">
          <option value="1">Level 1 - Wild Card</option>
          <option value="2">Level 2 - Opportunist</option>
          <option value="3" selected>Level 3 - Contender</option>
        </select>
      </div>
    </div>
    <div class="panel">
      <div class="row"><div><b>Move List</b></div></div>
      <div id="moves" class="moves"></div>
    </div>
    <div class="panel row" style="align-items:center">
      <div class="controls">
        <button class="btn" id="newGameBtn">New Game</button>
        <button class="btn" id="flipBtn">Flip</button>
      </div>
      <div class="tiny">You are playing as White.</div>
    </div>
  </div>
</div>
<canvas id="fx"></canvas>

<script>
/* ---------- UTILITIES ---------- */
const U={
  inBounds:(r,c)=>r>=0&&r<8&&c>=0&&c<8,
  clone:o=>JSON.parse(JSON.stringify(o)),
  toAlg:(r,c)=>"abcdefgh"[c]+(8-r)
};

const START=[
 ["r","n","b","q","k","b","n","r"],
 ["p","p","p","p","p","p","p","p"],
 ["","","","","","","",""],
 ["","","","","","","",""],
 ["","","","","","","",""],
 ["","","","","","","",""],
 ["P","P","P","P","P","P","P","P"],
 ["R","N","B","Q","K","B","N","R"]
];

let state={
  board:U.clone(START), side:'w',
  castling:{wk:true,wq:true,bk:true,bq:true},
  ep:null, half:0, full:1, hist:[]
};

const PIECES={r:"♜",n:"♞",b:"♝",q:"♛",k:"♚",p:"♟",R:"♖",N:"♘",B:"♗",Q:"♕",K:"♔",P:"♙"};
const boardEl=document.getElementById('board'),
      statusEl=document.getElementById('status'),
      incheckEl=document.getElementById('incheck'),
      crEl=document.getElementById('cr'),
      epEl=document.getElementById('ep'),
      movesEl=document.getElementById('moves'),
      flipBtn=document.getElementById('flipBtn'),
      newGameBtn=document.getElementById('newGameBtn');

let sel=null,leg=[],flip=false,over=false,aiLevel=3;

/* ---------- PIECE HELPERS ---------- */
function isWhite(p){return p && p===p.toUpperCase();}
function isBlack(p){return p && p===p.toLowerCase();}
function sidePiece(p,s){return s==='w'?isWhite(p):isBlack(p);}
function other(s){return s==='w'?'b':'w';}
function kingPos(b,s){const k=s==='w'?'K':'k';for(let r=0;r<8;r++)for(let c=0;c<8;c++)if(b[r][c]===k)return{r,c};return null;}
function attacked(b,r,c,bySide){
  // check if (r,c) attacked by side
  const tmp={board:b,side:bySide};
  return legalMoves(tmp,true).some(m=>m.to.r===r&&m.to.c===c);
}

/* ---------- MOVE GENERATION ---------- */
function legalMoves(st,skipCheck=false){
  const moves=[];
  for(let r=0;r<8;r++)for(let c=0;c<8;c++){
    const p=st.board[r][c]; if(!p||!sidePiece(p,st.side)) continue;
    // Pawn
    if(p.toLowerCase()==='p'){
      const dir=st.side==='w'?-1:1,startRow=st.side==='w'?6:1;
      if(U.inBounds(r+dir,c)&&!st.board[r+dir][c])moves.push({from:{r,c},to:{r:r+dir,c},promotion:(r+dir===0||r+dir===7)});
      for(const dc of[-1,1]){
        const rr=r+dir,cc=c+dc;
        if(U.inBounds(rr,cc)){
          if(st.board[rr][cc]&&sidePiece(st.board[rr][cc],other(st.side)))moves.push({from:{r,c},to:{r:rr,c:cc},capture:true,promotion:(rr===0||rr===7)});
          if(st.ep&&rr===st.ep.r&&cc===st.ep.c)moves.push({from:{r,c},to:{r:rr,c:cc},capture:true,enpassant:true});
        }
      }
    }
    // Knight
    if(p.toLowerCase()==='n'){
      for(const[dr,dc]of[[2,1],[1,2],[-1,2],[-2,1],[-2,-1],[-1,-2],[1,-2],[2,-1]]){
        const rr=r+dr,cc=c+dc;
        if(U.inBounds(rr,cc)&&(!st.board[rr][cc]||sidePiece(st.board[rr][cc],other(st.side))))moves.push({from:{r,c},to:{r:rr,c:cc},capture:!!st.board[rr][cc]});
      }
    }
    // Sliding
    const dirs=[];
    if("bq".includes(p.toLowerCase()))dirs.push([1,1],[1,-1],[-1,1],[-1,-1]);
    if("rq".includes(p.toLowerCase()))dirs.push([1,0],[-1,0],[0,1],[0,-1]);
    for(const[dr,dc]of dirs){
      let rr=r+dr,cc=c+dc;
      while(U.inBounds(rr,cc)){
        if(st.board[rr][cc]){
          if(sidePiece(st.board[rr][cc],other(st.side)))moves.push({from:{r,c},to:{r:rr,c:cc},capture:true});
          break;
        }else moves.push({from:{r,c},to:{r:rr,c:cc}});
        rr+=dr;cc+=dc;
      }
    }
    // King (no castling for simplicity)
    if(p.toLowerCase()==='k'){
      for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){if(dr||dc){
        const rr=r+dr,cc=c+dc;
        if(U.inBounds(rr,cc)&&(!st.board[rr][cc]||sidePiece(st.board[rr][cc],other(st.side))))moves.push({from:{r,c},to:{r:rr,c:cc},capture:!!st.board[rr][cc]});
      }}
    }
  }
  if(skipCheck)return moves;
  // filter out illegal (leaves king in check)
  return moves.filter(m=>{
    const tmp=U.clone(st);
    makeMove(tmp,m,true);
    const kp=kingPos(tmp.board,st.side);
    return kp&&!attacked(tmp.board,kp.r,kp.c,other(st.side));
  });
}

/* ---------- EXECUTION ---------- */
function makeMove(st,m,simulate=false){
  const f=st.board[m.from.r][m.from.c];
  if(m.enpassant){st.board[m.from.r][m.to.c]='';}
  st.board[m.to.r][m.to.c]=m.promotion?(st.side==='w'?'Q':'q'):f;
  st.board[m.from.r][m.from.c]='';
  if(!simulate){
    st.hist.push(m);
    movesEl.innerHTML+=`${U.toAlg(m.from.r,m.from.c)}-${U.toAlg(m.to.r,m.to.c)}<br>`;
    st.side=other(st.side);
  }
}

/* ---------- AI ---------- */
function evaluateBoard(board){
  const val={p:1,n:3,b:3,r:5,q:9,k:0,P:1,N:3,B:3,R:5,Q:9,K:0};
  let score=0;for(let r=0;r<8;r++)for(let c=0;c<8;c++){const p=board[r][c];if(!p)continue;score+=isBlack(p)?val[p]:-val[p];}
  return score;
}
function getAIMove(legal,level,st){
  if(!legal.length)return null;
  if(level===1)return legal[Math.floor(Math.random()*legal.length)];
  if(level===2){const caps=legal.filter(m=>m.capture);return caps.length?caps[Math.floor(Math.random()*caps.length)]:legal[Math.floor(Math.random()*legal.length)];}
  // level 3
  const scored=legal.map(m=>{const tmp=U.clone(st);makeMove(tmp,m,true);return{m,score:evaluateBoard(tmp.board)};});
  scored.sort((a,b)=>b.score-a.score);
  return scored[0].m;
}

/* ---------- RENDER ---------- */
function render(){
  boardEl.innerHTML='';
  const mapIdx=i=>flip?63-i:i;
  for(let r=0;r<8;r++)for(let c=0;c<8;c++){
    const i=r*8+c,idx=mapIdx(i),rr=Math.floor(idx/8),cc=idx%8;
    const sq=document.createElement('div');sq.className=`sq ${(r+c)%2?'dark':'light'}`;sq.dataset.r=rr;sq.dataset.c=cc;
    const p=state.board[rr][cc];if(p){const sp=document.createElement('span');sp.textContent=PIECES[p];sp.className=`piece ${isWhite(p)?'white':'black'}`;sq.appendChild(sp);}
    if(sel&&sel.r===rr&&sel.c===cc)sq.classList.add('sel');
    leg.forEach(m=>{if(m.to.r===rr&&m.to.c===cc){sq.classList.add(m.capture?'cap':'hint');}});
    boardEl.appendChild(sq);
  }
  const moves=legalMoves(state);
  const kp=kingPos(state.board,state.side);
  const check=kp&&attacked(state.board,kp.r,kp.c,other(state.side));
  incheckEl.style.display=check?'block':'none';
  if(!moves.length){
    over=true;
    statusEl.textContent=check?(state.side==='w'?'Checkmate, AI wins!':'Checkmate, You win!'):'Draw';
  }else{
    statusEl.textContent=state.side==='w'?'Your move':'AI is thinking...';
    if(state.side==='b'&&!over)setTimeout(triggerAI,400);
  }
}

/* ---------- LOOP ---------- */
function triggerAI(){
  const m=getAIMove(legalMoves(state),aiLevel,state);
  if(m){makeMove(state,m);render();}
}

/* ---------- EVENTS ---------- */
boardEl.addEventListener('click',e=>{
  const sq=e.target.closest('.sq');if(!sq||over||state.side!=='w')return;
  const r=+sq.dataset.r,c=+sq.dataset.c;
  if(sel){
    const mv=leg.find(m=>m.to.r===r&&m.to.c===c);
    if(mv){makeMove(state,mv);sel=null;leg=[];render();return;}
    sel=null;leg=[];
  }
  const p=state.board[r][c];
  if(p&&isWhite(p)){sel={r,c};leg=legalMoves(state).filter(m=>m.from.r===r&&m.from.c===c);render();}
});
flipBtn.addEventListener('click',()=>{flip=!flip;render();});
newGameBtn.addEventListener('click',()=>{state={board:U.clone(START),side:'w',castling:{wk:true,wq:true,bk:true,bq:true},ep:null,hist:[]};sel=null;leg=[];over=false;movesEl.innerHTML='';render();});

/* ---------- START ---------- */
render();
</script>
</body>
</html>
