<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>The Chess Arena Pi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #1f2937;
      --light-square: #f8fafc;
      --dark-square: #a3c8a3;
      --white-piece: khaki;
      --black-piece: #374151;
      --highlight: #facc15;
    }

    body {
      margin: 0;
      font-family: sans-serif;
      background: var(--bg);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
    }

    #logo {
      font-size: 2rem;
      margin-bottom: 1rem;
      font-weight: bold;
    }

    #pi-login {
      background: var(--highlight);
      color: black;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      margin-bottom: 1rem;
      font-weight: bold;
    }

    #board {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      width: 90vmin;
      height: 90vmin;
      border: 4px solid white;
    }

    .cell {
      width: 100%;
      height: 100%;
      font-size: 4vmin;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
    }

    .light { background: var(--light-square); }
    .dark { background: var(--dark-square); }

    .white { color: var(--white-piece); }
    .black { color: var(--black-piece); }

    #captured {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    .captured-box {
      border: 2px solid white;
      padding: 0.5rem;
      min-width: 6rem;
      text-align: center;
      font-size: 1.2rem;
    }

    #status {
      margin-top: 1rem;
      font-size: 1.2rem;
    }

    audio {
      display: none;
    }
  </style>
</head>
<body>

  <div id="logo">â™Ÿ The Chess Arena Pi</div>
  <div id="pi-login">Login with Pi (placeholder)</div>

  <div id="board"></div>

  <div id="captured">
    <div class="captured-box" id="white-captured">White Captured: </div>
    <div class="captured-box" id="black-captured">Black Captured: </div>
  </div>

  <div id="status">Tap a piece to begin</div>

  <audio id="move-sound" src="https://upload.wikimedia.org/wikipedia/commons/8/88/Chess_move_sound.mp3"></audio>
  <audio id="win-sound" src="https://upload.wikimedia.org/wikipedia/commons/4/41/Crowd_applause.ogg"></audio>

  <script>
    const boardEl = document.getElementById('board');
    const statusEl = document.getElementById('status');
    const whiteCapturedEl = document.getElementById('white-captured');
    const blackCapturedEl = document.getElementById('black-captured');
    const moveSound = document.getElementById('move-sound');
    const winSound = document.getElementById('win-sound');

    const board = [];
    const captured = { w: [], b: [] };

    const initial = [
      "rnbqkbnr",
      "pppppppp",
      "        ",
      "        ",
      "        ",
      "        ",
      "PPPPPPPP",
      "RNBQKBNR"
    ];

    const pieces = {
      P: { side: 'w', symbol: 'P' },
      R: { side: 'w', symbol: 'R' },
      N: { side: 'w', symbol: 'N' },
      B: { side: 'w', symbol: 'B' },
      Q: { side: 'w', symbol: 'Q' },
      K: { side: 'w', symbol: 'K' },
      p: { side: 'b', symbol: 'p' },
      r: { side: 'b', symbol: 'r' },
      n: { side: 'b', symbol: 'n' },
      b: { side: 'b', symbol: 'b' },
      q: { side: 'b', symbol: 'q' },
      k: { side: 'b', symbol: 'k' },
    };

    let selected = null;
    let currentTurn = 'w';

    function drawBoard() {
      boardEl.innerHTML = '';
      for (let y = 0; y < 8; y++) {
        board[y] = [];
        for (let x = 0; x < 8; x++) {
          const pieceChar = initial[y][x];
          const cell = document.createElement('div');
          const isLight = (x + y) % 2 === 0;
          cell.className = `cell ${isLight ? 'light' : 'dark'}`;
          cell.dataset.x = x;
          cell.dataset.y = y;
          if (pieceChar !== ' ') {
            const piece = pieces[pieceChar];
            cell.textContent = piece.symbol;
            cell.classList.add(piece.side === 'w' ? 'white' : 'black');
            board[y][x] = pieceChar;
          } else {
            board[y][x] = ' ';
          }
          cell.addEventListener('click', handleClick);
          boardEl.appendChild(cell);
        }
      }
    }

    function handleClick(e) {
      const x = +e.currentTarget.dataset.x;
      const y = +e.currentTarget.dataset.y;
      const pieceChar = board[y][x];
      const piece = pieces[pieceChar];

      if (selected) {
        const [fromX, fromY] = selected;
        if (fromX === x && fromY === y) {
          selected = null;
          statusEl.textContent = "Selection cleared.";
          return;
        }
        const targetChar = board[y][x];
        if (targetChar !== ' ' && pieces[targetChar].side === currentTurn) {
          selected = [x, y];
          statusEl.textContent = "Changed selection.";
          return;
        }
        movePiece(fromX, fromY, x, y);
        selected = null;
      } else {
        if (piece && piece.side === currentTurn) {
          selected = [x, y];
          statusEl.textContent = `Selected ${piece.symbol}`;
        }
      }
    }

    function movePiece(fromX, fromY, toX, toY) {
      const pieceChar = board[fromY][fromX];
      const targetChar = board[toY][toX];
      if (targetChar !== ' ') {
        const targetPiece = pieces[targetChar];
        captured[targetPiece.side].push(targetPiece.symbol);
        updateCaptured();
      }
      board[toY][toX] = pieceChar;
      board[fromY][fromX] = ' ';
      moveSound.play();
      drawBoard();
      checkWin();
      currentTurn = currentTurn === 'w' ? 'b' : 'w';
      statusEl.textContent = currentTurn === 'w' ? "White's turn" : "Black's turn";
    }

    function updateCaptured() {
      whiteCapturedEl.textContent = "White Captured: " + captured.b.join(' ');
      blackCapturedEl.textContent = "Black Captured: " + captured.w.join(' ');
    }

    function checkWin() {
      let flat = board.flat().join('');
      if (!flat.includes('k')) {
        statusEl.textContent = "White wins!";
        winSound.play();
      }
      if (!flat.includes('K')) {
        statusEl.textContent = "Black wins!";
        winSound.play();
      }
    }

    drawBoard();
  </script>
</body>
</html>
