<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chess Arena Pi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
    }

    h1 {
      margin-top: 10px;
      font-size: 28px;
      color: #f9d342;
    }

    .timer-bar {
      display: flex;
      justify-content: space-between;
      margin: 10px 20px;
      font-size: 20px;
      font-weight: bold;
    }

    .mode-select, .buttons, .placeholders {
      margin: 10px 0;
    }

    #chessboard {
      width: 95vmin;
      height: 95vmin;
      margin: 10px auto;
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      grid-template-rows: repeat(8, 1fr);
      border: 5px solid #5c3a21;
      background-color: #e0c097;
    }

    .square {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      user-select: none;
    }

    .light {
      background-color: #e0c097;
    }

    .dark {
      background-color: #8b5e3c;
    }

    .captured {
      margin: 5px 0;
      font-size: 16px;
    }

    button {
      padding: 10px 16px;
      font-size: 16px;
      margin: 5px;
      border: none;
      border-radius: 6px;
      background-color: #f9d342;
      color: #111;
      font-weight: bold;
      cursor: pointer;
    }

    button:hover {
      background-color: #ffe476;
    }

    .placeholder {
      font-size: 14px;
      opacity: 0.6;
      margin: 4px;
    }

    canvas.confetti {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1000;
    }
  </style>
</head>
<body>

  <h1>‚ôû Chess Arena Pi</h1>
  <div class="timer-bar">
    <span id="white-timer">05:00</span>
    <span># Your Move!</span>
    <span id="black-timer">05:00</span>
  </div>

  <div class="mode-select">
    Mode: <strong>Play with Smart AI</strong>
  </div>

  <div id="chessboard"></div>

  <div class="captured">White Captured: <span id="white-captured"></span></div>
  <div class="captured">Black Captured: <span id="black-captured"></span></div>

  <div class="buttons">
    <button onclick="startGame()">Play with Smart AI</button>
  </div>

  <div class="placeholders">
    <div class="placeholder">üîí Pi Login Placeholder</div>
    <div class="placeholder">üèÜ Leaderboard Placeholder</div>
  </div>

  <canvas class="confetti"></canvas>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/1.0.0/chess.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/confetti-js/0.0.18/confetti.min.js"></script>
  <script>
    const boardElement = document.getElementById('chessboard');
    const whiteTimer = document.getElementById('white-timer');
    const blackTimer = document.getElementById('black-timer');
    const whiteCaptured = document.getElementById('white-captured');
    const blackCaptured = document.getElementById('black-captured');

    let game, boardSquares = [], selected = null, capturedW = [], capturedB = [];
    let turn = 'w', interval, timeW = 300, timeB = 300;
    const pieces = {
      r: '‚ôú', n: '‚ôû', b: '‚ôù', q: '‚ôõ', k: '‚ôö', p: '‚ôü',
      R: '‚ôñ', N: '‚ôò', B: '‚ôó', Q: '‚ôï', K: '‚ôî', P: '‚ôô'
    };

    function drawBoard() {
      boardElement.innerHTML = '';
      boardSquares = [];
      const position = game.board();
      for (let y = 7; y >= 0; y--) {
        for (let x = 0; x < 8; x++) {
          const square = document.createElement('div');
          square.className = 'square ' + ((x + y) % 2 === 0 ? 'light' : 'dark');
          const piece = position[y][x];
          if (piece) square.textContent = pieces[piece.color === 'w' ? piece.type.toUpperCase() : piece.type];
          square.dataset.x = x;
          square.dataset.y = y;
          square.onclick = onSquareClick;
          boardElement.appendChild(square);
          boardSquares.push(square);
        }
      }
    }

    function onSquareClick(e) {
      const x = e.currentTarget.dataset.x;
      const y = e.currentTarget.dataset.y;
      const square = 'abcdefgh'[x] + (parseInt(y) + 1);
      if (selected) {
        const move = game.move({ from: selected, to: square, promotion: 'q' });
        if (move) {
          playSound('move');
          if (move.captured) {
            if (move.color === 'w') capturedB.push(pieces[move.captured]);
            else capturedW.push(pieces[move.captured.toUpperCase()]);
          }
          selected = null;
          update();
          if (game.in_checkmate()) {
            showWin(game.turn() === 'w' ? 'Black' : 'White');
          } else if (game.turn() === 'b') {
            setTimeout(() => aiMove(), 400);
          }
          return;
        }
      }
      const piece = game.get(square);
      if (piece && piece.color === 'w' && game.turn() === 'w') {
        selected = square;
      }
    }

    function aiMove() {
      const moves = game.moves();
      const move = moves[Math.floor(Math.random() * moves.length)];
      game.move(move);
      update();
      if (game.in_checkmate()) {
        showWin('Black');
      }
    }

    function update() {
      drawBoard();
      whiteCaptured.innerText = capturedW.join(' ');
      blackCaptured.innerText = capturedB.join(' ');
    }

    function startGame() {
      game = new Chess();
      timeW = 300;
      timeB = 300;
      capturedW = [];
      capturedB = [];
      update();
      clearInterval(interval);
      interval = setInterval(updateTimers, 1000);
    }

    function updateTimers() {
      if (game.game_over()) return;
      if (game.turn() === 'w') timeW--;
      else timeB--;
      whiteTimer.innerText = formatTime(timeW);
      blackTimer.innerText = formatTime(timeB);
      if (timeW <= 0 || timeB <= 0) {
        showWin(timeW <= 0 ? 'Black' : 'White');
      }
    }

    function formatTime(t) {
      const m = Math.floor(t / 60).toString().padStart(2, '0');
      const s = (t % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    function showWin(winner) {
      clearInterval(interval);
      playSound('win');
      launchConfetti();
      alert(`${winner} wins!`);
    }

    function playSound(type) {
      let audio = new Audio();
      if (type === 'move') audio.src = 'https://www.soundjay.com/button/sounds/button-16.mp3';
      if (type === 'win') audio.src = 'https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3';
      audio.play();
    }

    function launchConfetti() {
      const confetti = new ConfettiGenerator({ target: 'confetti' });
      confetti.render();
      setTimeout(() => confetti.clear(), 5000);
    }

    startGame();
  </script>
</body>
</html>
