<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chess Arena Pi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #1e1e1e;
      color: #f9f9f9;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin-top: 10px;
      font-size: 30px;
      color: #f9d342;
      letter-spacing: 1px;
      text-shadow: 0 2px 5px #000;
    }

    .timer-bar {
      display: flex;
      justify-content: space-around;
      width: 90%;
      font-size: 18px;
      margin-top: 5px;
    }

    #chessboard {
      width: 95vmin;
      height: 95vmin;
      margin: 15px auto;
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      grid-template-rows: repeat(8, 1fr);
      border: 6px solid #5a3921;
      box-shadow: 0 0 10px #000;
    }

    .square {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 34px;
      user-select: none;
      font-weight: bold;
    }

    .light {
      background-color: #d2b48c;
    }

    .dark {
      background-color: #8b5e3c;
    }

    .captured {
      font-size: 16px;
      margin: 4px 0;
    }

    button {
      background-color: #f9d342;
      color: #111;
      border: none;
      padding: 12px 18px;
      font-size: 16px;
      font-weight: bold;
      border-radius: 10px;
      margin: 10px 5px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.3);
      cursor: pointer;
    }

    button:hover {
      background-color: #ffe476;
    }

    .placeholder {
      font-size: 14px;
      color: #bbb;
      margin: 5px 0;
    }

    #thinking {
      font-size: 16px;
      color: #f9d342;
      margin: 6px 0;
      visibility: hidden;
    }

    canvas#confetti {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 1000;
    }
  </style>
</head>
<body>

  <h1>‚ôû Chess Arena Pi</h1>

  <div class="timer-bar">
    <div id="white-timer">05:00</div>
    <div></div>
    <div id="black-timer">05:00</div>
  </div>

  <div id="chessboard"></div>

  <div class="captured"><span id="white-captured"></span></div>
  <div class="captured"><span id="black-captured"></span></div>

  <button onclick="startGame()">Play with Smart AI</button>

  <div id="thinking">ü§ñ AI is thinking...</div>

  <div class="placeholder">üîí Pi Login Placeholder</div>
  <div class="placeholder">üèÜ Leaderboard Placeholder</div>

  <canvas id="confetti"></canvas>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/1.0.0/chess.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/confetti-js/0.0.18/confetti.min.js"></script>
  <script>
    const board = document.getElementById('chessboard');
    const whiteTimer = document.getElementById('white-timer');
    const blackTimer = document.getElementById('black-timer');
    const whiteCaptured = document.getElementById('white-captured');
    const blackCaptured = document.getElementById('black-captured');
    const thinking = document.getElementById('thinking');

    let game, selected = null, interval, timeW = 300, timeB = 300;
    let capturedW = [], capturedB = [];
    let inputLocked = false;

    const pieces = {
      r: '‚ôú', n: '‚ôû', b: '‚ôù', q: '‚ôõ', k: '‚ôö', p: '‚ôü',
      R: '‚ôñ', N: '‚ôò', B: '‚ôó', Q: '‚ôï', K: '‚ôî', P: '‚ôô'
    };

    function drawBoard() {
      board.innerHTML = '';
      const position = game.board();
      for (let y = 7; y >= 0; y--) {
        for (let x = 0; x < 8; x++) {
          const square = document.createElement('div');
          square.className = 'square ' + ((x + y) % 2 === 0 ? 'light' : 'dark');
          const piece = position[y][x];
          if (piece) {
            square.textContent = pieces[piece.color === 'w' ? piece.type.toUpperCase() : piece.type];
          }
          square.dataset.x = x;
          square.dataset.y = y;
          square.addEventListener('click', onSquareClick); // ‚úÖ use event listener
          board.appendChild(square);
        }
      }
    }

    function onSquareClick(e) {
      if (inputLocked || game.game_over()) return;

      const x = e.currentTarget.dataset.x;
      const y = e.currentTarget.dataset.y;
      const square = 'abcdefgh'[x] + (parseInt(y) + 1);

      if (selected) {
        const move = game.move({ from: selected, to: square, promotion: 'q' });
        if (move) {
          playSound('move');
          if (move.captured) {
            if (move.color === 'w') capturedB.push(pieces[move.captured]);
            else capturedW.push(pieces[move.captured.toUpperCase()]);
          }
          selected = null;
          update();
          if (game.in_checkmate()) {
            showWin(game.turn() === 'w' ? 'Black' : 'White');
          } else if (game.turn() === 'b') {
            inputLocked = true;
            thinking.style.visibility = 'visible';
            setTimeout(aiMove, 200); // faster response
          }
          return;
        }
      }

      const piece = game.get(square);
      if (piece && piece.color === 'w' && game.turn() === 'w') {
        selected = square;
      }
    }

    function aiMove() {
      const moves = game.moves();
      if (moves.length === 0) return;
      const move = moves[Math.floor(Math.random() * moves.length)];
      game.move(move);
      playSound('move');
      update();
      inputLocked = false;
      thinking.style.visibility = 'hidden';
      if (game.in_checkmate()) showWin('Black');
    }

    function update() {
      drawBoard();
      whiteCaptured.innerText = capturedW.join(' ');
      blackCaptured.innerText = capturedB.join(' ');
    }

    function startGame() {
      game = new Chess();
      timeW = 300;
      timeB = 300;
      capturedW = [];
      capturedB = [];
      inputLocked = false;
      thinking.style.visibility = 'hidden';
      update();
      clearInterval(interval);
      interval = setInterval(updateTimers, 1000);
    }

    function updateTimers() {
      if (game.game_over()) return;
      if (game.turn() === 'w') timeW--;
      else timeB--;
      whiteTimer.innerText = formatTime(timeW);
      blackTimer.innerText = formatTime(timeB);
      if (timeW <= 0 || timeB <= 0) showWin(timeW <= 0 ? 'Black' : 'White');
    }

    function formatTime(t) {
      const m = String(Math.floor(t / 60)).padStart(2, '0');
      const s = String(t % 60).padStart(2, '0');
      return `${m}:${s}`;
    }

    function showWin(winner) {
      clearInterval(interval);
      playSound('win');
      launchConfetti();
      alert(`${winner} wins!`);
    }

    function playSound(type) {
      let audio = new Audio();
      if (type === 'move') audio.src = 'https://www.soundjay.com/button/sounds/button-16.mp3';
      if (type === 'win') audio.src = 'https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3';
      audio.play();
    }

    function launchConfetti() {
      const confetti = new ConfettiGenerator({ target: 'confetti' });
      confetti.render();
      setTimeout(() => confetti.clear(), 4000);
    }

    startGame();
  </script>
</body>
</html>
