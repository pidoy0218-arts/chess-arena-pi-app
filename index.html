<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>The Chess Arena Pi</title>
  <style>
    :root {
      --light: #f0d9b5;
      --dark: #b58863;
      --ivory: #f5f5f5;
      --ebony: #333;
      --bg: #1f1f1f;
      --text: #f0f0f0;
    }

    body {
      margin: 0;
      font-family: sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
    }

    h1 {
      font-size: 1.6em;
      margin: 10px 0;
    }

    #login {
      background: #3b3b3b;
      padding: 10px 20px;
      border-radius: 10px;
      margin-bottom: 10px;
      color: #fff;
    }

    #board {
      display: grid;
      grid-template-columns: repeat(8, 50px);
      grid-template-rows: repeat(8, 50px);
      border: 4px solid #000;
      margin: 10px 0;
    }

    .square {
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      user-select: none;
    }

    .light {
      background: var(--light);
    }

    .dark {
      background: var(--dark);
    }

    .piece.white {
      color: var(--ivory);
      text-shadow: 1px 1px #000;
    }

    .piece.black {
      color: var(--ebony);
    }

    #status {
      margin-top: 10px;
      font-size: 1.2em;
    }

    #confetti {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 10;
    }
  </style>
</head>
<body>
  <h1>‚ôüÔ∏è The Chess Arena Pi</h1>
  <div id="login">üîê Login with Pi (placeholder)</div>
  <div id="board"></div>
  <div id="status">Your move...</div>
  <canvas id="confetti"></canvas>
  <audio id="moveSound" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>
  <audio id="winSound" src="https://actions.google.com/sounds/v1/human_voices/cheer.ogg"></audio>

  <script>
    const boardEl = document.getElementById("board");
    const statusEl = document.getElementById("status");
    const moveSound = document.getElementById("moveSound");
    const winSound = document.getElementById("winSound");

    let game = new Chess();

    function renderBoard() {
      boardEl.innerHTML = "";
      const board = game.board();
      for (let r = 7; r >= 0; r--) {
        for (let c = 0; c < 8; c++) {
          const square = document.createElement("div");
          square.className = "square " + ((r + c) % 2 === 0 ? "light" : "dark");
          square.dataset.row = r;
          square.dataset.col = c;
          const piece = board[r][c];
          if (piece) {
            const pieceEl = document.createElement("div");
            pieceEl.className = `piece ${piece.color === 'w' ? 'white' : 'black'}`;
            pieceEl.textContent = getPieceSymbol(piece);
            square.appendChild(pieceEl);
          }
          square.addEventListener("click", () => handleClick(r, c));
          boardEl.appendChild(square);
        }
      }
    }

    let selected = null;

    function handleClick(r, c) {
      const square = String.fromCharCode(97 + c) + (r + 1);
      if (selected) {
        const move = game.move({ from: selected, to: square, promotion: "q" });
        if (move) {
          moveSound.play();
          selected = null;
          renderBoard();
          checkStatus();
        } else {
          selected = null;
          statusEl.textContent = "Illegal move!";
        }
      } else {
        const piece = game.get(square);
        if (piece && piece.color === game.turn()) {
          selected = square;
        }
      }
    }

    function checkStatus() {
      if (game.in_checkmate()) {
        statusEl.textContent = "Checkmate! " + (game.turn() === "w" ? "Black" : "White") + " wins!";
        winSound.play();
        launchConfetti();
      } else if (game.in_stalemate()) {
        statusEl.textContent = "Stalemate!";
      } else if (game.in_draw()) {
        statusEl.textContent = "Draw!";
      } else {
        statusEl.textContent = (game.turn() === "w" ? "White" : "Black") + "'s move";
      }
    }

    function getPieceSymbol(piece) {
      const symbols = {
        p: "‚ôü", r: "‚ôú", n: "‚ôû", b: "‚ôù", q: "‚ôõ", k: "‚ôö"
      };
      return symbols[piece.type];
    }

    // Load chess.js from CDN
    const script = document.createElement("script");
    script.src = "https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.12.0/chess.min.js";
    script.onload = () => {
      game = new Chess();
      renderBoard();
      statusEl.textContent = "White's move";
    };
    document.head.appendChild(script);

    // Simple confetti
    function launchConfetti() {
      const confetti = document.getElementById("confetti");
      const ctx = confetti.getContext("2d");
      confetti.width = window.innerWidth;
      confetti.height = window.innerHeight;
      const particles = [];

      for (let i = 0; i < 100; i++) {
        particles.push({
          x: Math.random() * confetti.width,
          y: Math.random() * confetti.height - confetti.height,
          size: Math.random() * 6 + 4,
          speed: Math.random() * 3 + 2,
          color: `hsl(${Math.random() * 360}, 100%, 70%)`,
        });
      }

      function draw() {
        ctx.clearRect(0, 0, confetti.width, confetti.height);
        for (let p of particles) {
          ctx.fillStyle = p.color;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          ctx.fill();
          p.y += p.speed;
          if (p.y > confetti.height) p.y = -p.size;
        }
        requestAnimationFrame(draw);
      }

      draw();
    }
  </script>
</body>
</html>
