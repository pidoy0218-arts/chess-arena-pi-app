<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‚ôüÔ∏è The Chess Arena Pi</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/1.0.0/chess.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/confetti-js@0.0.18/dist/index.min.js"></script>
  <style>
    body {
      margin: 0;
      background: #1e1e1e;
      color: #fff;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
    }
    h1 {
      margin: 10px;
      font-size: 1.4rem;
    }
    #login-placeholder {
      padding: 8px 16px;
      border: 2px dashed #888;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      width: 90vmin;
      height: 90vmin;
      max-width: 90vw;
      max-height: 90vw;
      border: 5px solid #5a3e1b;
      box-shadow: 0 0 15px #000;
    }
    .square {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .light {
      background-color: #e0c38c;
    }
    .dark {
      background-color: #9e673c;
    }
    .piece {
      width: 90%;
      height: 90%;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }
    #status {
      margin: 10px;
      font-size: 1.2rem;
    }
    #leaderboard {
      margin-top: 10px;
      width: 90%;
      max-width: 400px;
      background: #2a2a2a;
      padding: 10px;
      border-radius: 8px;
    }
    #leaderboard h2 {
      margin-top: 0;
      font-size: 1rem;
    }
    #leaderboard ul {
      padding-left: 20px;
    }
    canvas {
      position: fixed;
      top: 0;
      left: 0;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <h1>‚ôüÔ∏è The Chess Arena Pi</h1>
  <div id="login-placeholder">üîê Pi Login Placeholder</div>
  <div id="status">Your move</div>
  <div id="board"></div>
  <div id="leaderboard">
    <h2>üèÜ Leaderboard</h2>
    <ul id="score-list"></ul>
  </div>
  <canvas id="confetti-canvas"></canvas>
  <audio id="win-sound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_09f9fd3932.mp3?filename=success-fanfare-trumpets-6185.mp3"></audio>
  <audio id="lose-sound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_9491d2169d.mp3?filename=failure-drum-8312.mp3"></audio>

  <script>
    const PIECES = {
      wK: "https://upload.wikimedia.org/wikipedia/commons/4/42/Chess_klt60.png",
      wQ: "https://upload.wikimedia.org/wikipedia/commons/1/15/Chess_qlt60.png",
      wR: "https://upload.wikimedia.org/wikipedia/commons/7/72/Chess_rlt60.png",
      wB: "https://upload.wikimedia.org/wikipedia/commons/b/b1/Chess_blt60.png",
      wN: "https://upload.wikimedia.org/wikipedia/commons/7/70/Chess_nlt60.png",
      wP: "https://upload.wikimedia.org/wikipedia/commons/4/45/Chess_plt60.png",
      bK: "https://upload.wikimedia.org/wikipedia/commons/f/f0/Chess_kdt60.png",
      bQ: "https://upload.wikimedia.org/wikipedia/commons/4/47/Chess_qdt60.png",
      bR: "https://upload.wikimedia.org/wikipedia/commons/f/ff/Chess_rdt60.png",
      bB: "https://upload.wikimedia.org/wikipedia/commons/9/98/Chess_bdt60.png",
      bN: "https://upload.wikimedia.org/wikipedia/commons/e/ef/Chess_ndt60.png",
      bP: "https://upload.wikimedia.org/wikipedia/commons/c/c7/Chess_pdt60.png"
    };

    const boardEl = document.getElementById("board");
    const statusEl = document.getElementById("status");
    const scoreList = document.getElementById("score-list");
    const confettiCanvas = document.getElementById("confetti-canvas");
    const winSound = document.getElementById("win-sound");
    const loseSound = document.getElementById("lose-sound");
    const chess = new Chess();
    const confetti = new ConfettiGenerator({ target: confettiCanvas });

    let playerColor = 'w';

    function renderBoard() {
      boardEl.innerHTML = '';
      const board = chess.board();
      for (let r = 0; r < 8; r++) {
        for (let c = 0; c < 8; c++) {
          const square = document.createElement("div");
          square.className = "square " + ((r + c) % 2 === 0 ? "light" : "dark");
          square.dataset.row = r;
          square.dataset.col = c;
          const piece = board[r][c];
          if (piece) {
            const pieceDiv = document.createElement("div");
            pieceDiv.className = "piece";
            pieceDiv.style.backgroundImage = `url(${PIECES[piece.color + piece.type.toUpperCase()]})`;
            square.appendChild(pieceDiv);
          }
          square.onclick = () => handleClick(r, c);
          boardEl.appendChild(square);
        }
      }
    }

    let selected = null;

    function handleClick(r, c) {
      const square = String.fromCharCode(97 + c) + (8 - r);
      const piece = chess.get(square);

      if (selected) {
        const move = chess.move({ from: selected, to: square, promotion: 'q' });
        selected = null;
        if (move) {
          renderBoard();
          if (chess.game_over()) return endGame();
          setTimeout(aiMove, 300);
        } else {
          renderBoard();
        }
      } else if (piece && piece.color === playerColor) {
        selected = square;
      }
    }

    function aiMove() {
      const moves = chess.moves();
      const move = moves[Math.floor(Math.random() * moves.length)];
      chess.move(move);
      renderBoard();
      if (chess.game_over()) endGame();
    }

    function endGame() {
      const result = chess.in_checkmate()
        ? (chess.turn() === playerColor ? 'You Lose' : 'You Win')
        : 'Draw';

      statusEl.textContent = `Game Over: ${result}`;
      if (result === 'You Win') {
        confetti.render();
        winSound.play();
        updateLeaderboard('Player');
      } else if (result === 'You Lose') {
        loseSound.play();
        updateLeaderboard('AI');
      }
    }

    function updateLeaderboard(winner) {
      const li = document.createElement('li');
      li.textContent = `${winner} won at ${new Date().toLocaleTimeString()}`;
      scoreList.prepend(li);
    }

    renderBoard();
  </script>
</body>
</html>
