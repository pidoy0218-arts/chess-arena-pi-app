<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Chess Arena for Pi — Flow (Vertical)</title>
<style>
  :root{
    --bg-dark: #0f1114;
    --panel: #131419;
    --card: #1b1f25;
    --accent: #f4b400;   /* gold */
    --accent-2: #8bd450; /* green */
    --muted: #9aa0a6;
    --wood-light: #f0d9b5;
    --wood-dark:  #8b4a2a;
    --ivory: #ffffff;
    --ebony: #222222;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-dark),#06070a);font-family:Inter,system-ui,Segoe UI,Roboto,-apple-system;color:#fff}
  .app {
    height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
  }

  /* Each frame is a centered vertical card */
  .frame {
    width:100%;
    max-width:840px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:14px;
    padding:22px;
    box-shadow: 0 18px 60px rgba(0,0,0,0.6);
    display:none;
    flex-direction:column;
    gap:18px;
    align-items:center;
    min-height:70vh;
    border:1px solid rgba(255,255,255,0.03);
  }
  .frame.active { display:flex; }

  /* Top logo + title (centered) */
  .logo-wrap { display:flex; flex-direction:column; align-items:center; gap:10px; }
  .logo-circle {
    width:120px;height:120px;border-radius:50%;display:grid;place-items:center;
    background:linear-gradient(180deg,var(--accent),#d18c00);
    box-shadow: 0 8px 28px rgba(0,0,0,0.5), 0 0 0 8px rgba(244,180,0,0.07);
    transform-origin:center;
  }
  .logo-circle svg{ width:78px; height:78px; display:block; }
  .title { font-weight:800; font-size:26px; letter-spacing:0.6px; }
  .subtitle { font-size:12px; color:var(--muted); font-weight:700; opacity:0.95; }

  /* Row / column helpers */
  .row { display:flex; gap:12px; align-items:center; }
  .col { display:flex; flex-direction:column; gap:8px; align-items:center; }

  /* Buttons */
  .btn {
    padding:10px 16px; border-radius:12px; font-weight:700; border:0; cursor:pointer;
    background:linear-gradient(180deg,#2d2f33,#141516); color:#fff;
    box-shadow: 0 8px 20px rgba(0,0,0,0.45);
  }
  .btn.primary { background:linear-gradient(180deg,var(--accent),#d18c00); color:#111 }
  .btn.positive { background:linear-gradient(180deg,var(--accent-2),#6fbf29); color:#07100a }
  .btn.secondary { background:transparent; border:1px solid rgba(255,255,255,0.06) }

  .btn.dim { opacity:0.6; transform:scale(.99); }

  /* Invite friends list */
  .friends-list { width:100%; max-width:520px; background:rgba(255,255,255,0.02); padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,0.03); }
  .friend { display:flex; justify-content:space-between; padding:8px 10px; border-bottom:1px solid rgba(255,255,255,0.02); align-items:center; }
  .friend:last-child{border-bottom:0}
  .small { font-size:13px; color:var(--muted) }

  /* Game selector badges */
  .mode-grid { display:flex; gap:12px; align-items:center; }
  .mode-card { width:160px; padding:12px; border-radius:10px; text-align:center; background:rgba(0,0,0,0.18); border:1px solid rgba(255,255,255,0.03); }
  .badge { display:inline-block; padding:6px 8px; border-radius:999px; font-weight:800; color:#111; background:#fff; font-size:12px }

  /* Board (centered column layout) */
  .board-area { display:flex; flex-direction:column; gap:12px; align-items:center; width:100%; }
  .topbar { width:100%; display:flex; justify-content:space-between; align-items:center; gap:8px; padding:8px 12px; background:rgba(255,255,255,0.01); border-radius:8px; border:1px solid rgba(255,255,255,0.02); }
  .player-id { font-weight:800; }
  .captured { font-size:12px; color:var(--muted) }

  .board { width:420px; max-width:84vw; aspect-ratio:1; display:grid; grid-template-columns:repeat(8,1fr); border-radius:10px; overflow:hidden; border:6px solid #523217; box-shadow: 0 8px 30px rgba(0,0,0,0.6); background:linear-gradient(180deg,var(--wood-light),#dfcaa3) }
  .square { width:100%; height:100%; display:flex; align-items:center; justify-content:center; position:relative; }
  .sq-light { background: linear-gradient(180deg,var(--wood-light), #f0cf9e); }
  .sq-dark  { background: linear-gradient(180deg,var(--wood-dark), #6b3e23); color:#fff; }

  .piece { width:72%; height:72%; border-radius:8px; display:grid; place-items:center; font-weight:900; font-size:18px; box-shadow: 0 6px 16px rgba(0,0,0,0.45); }
  .piece.white { background:var(--ivory); color:#1b1b1b; }
  .piece.black { background:var(--ebony); color:#fff; }

  /* Timers */
  .timers { display:flex; gap:12px; align-items:center; justify-content:center; }
  .clock { padding:8px 12px; border-radius:8px; background:rgba(0,0,0,0.18); font-weight:800; min-width:98px; text-align:center }
  .clock.red { color:#ff4040; }

  /* result screens */
  .result { font-size:28px; font-weight:900; padding:12px; color:#fff; }
  .muted { color:var(--muted); font-size:13px }

  /* small responsiveness */
  @media (max-width:720px){
    .board{ width:90vw; }
    .logo-circle { width:96px;height:96px }
  }
</style>
</head>
<body>
  <div class="app">
    <!-- INTRO: animated logo + start -->
    <section id="frame-intro" class="frame active" aria-label="Intro">
      <div class="logo-wrap">
        <div class="logo-circle" id="logoCircle" title="Chess Arena logo">
          <!-- stylized knight-ish mark (not pi symbol). Trademark safe. -->
          <svg viewBox="0 0 100 100" aria-hidden="true">
            <circle cx="50" cy="50" r="46" fill="none" stroke="rgba(0,0,0,0.08)" stroke-width="4"/>
            <path d="M30 60c8-16 30-20 42-8 5 5 11 6 16 4 4-1.5 6-3 9-1.5 3 1.3 1.5 5-1.5 7-3 2.5-8 4-12 4-5 0-9-1.8-14-5-5-3.2-6.8-6.3-16-4.7-5 .9-9-2-13-7-1.8-2.8-1-5.4 0-6.8z"
                  fill="#fff" opacity="0.95"/>
          </svg>
        </div>
        <div class="title">CHESS ARENA <span style="color:var(--accent)">for Pi</span></div>
        <div class="subtitle">Classic & Quick chess testflow — hackathon-ready mock</div>
      </div>

      <div style="margin-top:8px">
        <button class="btn primary" id="btnStart">Enter</button>
        <button class="btn secondary" onclick="showFrame('frame-login')">Sign in (Pi)</button>
      </div>
      <div style="margin-top:8px" class="muted">Intro includes a light animation and fanfare (click Enter to proceed)</div>
    </section>

    <!-- LOGIN FRAME -->
    <section id="frame-login" class="frame" aria-label="Login (Pi)">
      <div class="logo-wrap">
        <div class="logo-circle" aria-hidden="true">
          <!-- small logo -->
          <svg viewBox="0 0 100 100" aria-hidden="true"><circle cx="50" cy="50" r="46" fill="none" stroke="rgba(0,0,0,0.08)" stroke-width="4"/></svg>
        </div>
        <div class="title">Sign in with Pi</div>
        <div class="muted">Pi SDK placeholder — clicking Sign in will simulate a Pioneer login.</div>
      </div>

      <div class="row">
        <button class="btn primary" id="btnSimLogin">Sign in (simulate)</button>
        <button class="btn secondary" onclick="showFrame('frame-intro')">Back</button>
      </div>
    </section>

    <!-- INVITE ROOT FRAME (lets user choose Friends / Random / Leaderboard split) -->
    <section id="frame-invite" class="frame" aria-label="Invite / Opponent select">
      <div class="logo-wrap">
        <div class="title">Invite & Opponent Selection</div>
        <div class="muted">Use Friends list, Competition leaderboard, or Play Random</div>
      </div>

      <div class="row">
        <button class="btn" onclick="showFrame('frame-friends')">Invite Friends</button>
        <button class="btn" onclick="mockRandomAndProceed()">Play Random</button>
        <button class="btn" onclick="showFrame('frame-leaderboards')">Competition Leaderboard</button>
      </div>

      <div class="row">
        <button class="btn secondary" onclick="showFrame('frame-login')">Back</button>
      </div>
    </section>

    <!-- FRIENDS SUBFRAME (mock friend list) -->
    <section id="frame-friends" class="frame" aria-label="Friends list">
      <div class="logo-wrap"><div class="title">Your Pi Friends (mock)</div><div class="muted">Check who to invite</div></div>

      <div class="friends-list" id="friendsList">
        <!-- JS fills this -->
      </div>

      <div class="row">
        <button class="btn primary" id="btnInviteSelected">Invite & Continue</button>
        <button class="btn secondary" onclick="showFrame('frame-invite')">Back</button>
      </div>
    </section>

    <!-- LEADERBOARDS (split: Friends / Competition) -->
    <section id="frame-leaderboards" class="frame" aria-label="Leaderboards">
      <div class="logo-wrap"><div class="title">Leaderboards</div><div class="muted">Friends / Competition</div></div>

      <div class="row" style="gap:8px;">
        <button class="btn" onclick="renderLeaderboard('friends')">Friends</button>
        <button class="btn" onclick="renderLeaderboard('competition')">Competition</button>
      </div>

      <div id="leaderboardArea" style="width:100%;max-width:680px;padding:12px;background:rgba(255,255,255,0.02);border-radius:10px;border:1px solid rgba(255,255,255,0.03)">
        <div class="muted">Select view</div>
      </div>

      <div class="row">
        <button class="btn secondary" onclick="showFrame('frame-invite')">Back</button>
      </div>
    </section>

    <!-- GAME SELECTOR -->
    <section id="frame-game-select" class="frame" aria-label="Mode select">
      <div class="logo-wrap"><div class="title">Choose a Mode</div><div class="muted">Quick = 30s per move (blitz). Classic = 10m per player.</div></div>

      <div class="mode-grid">
        <div class="mode-card">
          <div style="font-weight:900">Quick</div>
          <div class="muted">30s / move</div>
          <div style="margin-top:8px"><span class="badge" style="background:#ffcc99">BLITZ</span></div>
          <div style="margin-top:8px"><button class="btn primary" onclick="startMatch('quick')">Play Quick</button></div>
        </div>

        <div class="mode-card">
          <div style="font-weight:900">Classic</div>
          <div class="muted">10:00 per player</div>
          <div style="margin-top:8px"><span class="badge" style="background:#d0d0ff">RATED</span></div>
          <div style="margin-top:8px"><button class="btn" onclick="startMatch('classic')">Play Classic</button></div>
        </div>
      </div>

      <div class="row"><button class="btn secondary" onclick="showFrame('frame-invite')">Back</button></div>
    </section>

    <!-- BOARD FRAME (shared, behavior adapts by mode) -->
    <section id="frame-board" class="frame" aria-label="Board">
      <div class="logo-wrap">
        <div class="title" id="boardTitle">Match — Quick</div>
        <div class="muted" id="matchSub">Opponent: <span id="opponentName">RandomPlayer42</span></div>
      </div>

      <div class="board-area" style="width:100%;align-items:center;">
        <div class="topbar" style="max-width:92%">
          <div style="display:flex;gap:12px;align-items:center">
            <div class="player-id" id="topPlayerId">Opponent</div>
            <div class="captured muted" id="topCaptured">Captured: -</div>
          </div>
          <div class="timers">
            <div class="clock" id="oppClock">00:00</div>
            <div class="clock" id="turnIndicator">▶︎</div>
            <div class="clock" id="myClock">00:00</div>
          </div>
        </div>

        <div class="board" id="chessBoard" aria-hidden="true"></div>

        <div style="display:flex;gap:10px;align-items:center;flex-direction:column;width:100%;">
          <div style="display:flex; gap:8px; align-items:center;">
            <button class="btn primary" id="makeMoveBtn">Make Move</button>
            <button class="btn" id="resignBtn">Resign</button>
            <button class="btn secondary" id="offerDrawBtn">Offer Draw</button>
            <button class="btn secondary" onclick="showFrame('frame-game-select')">Back</button>
          </div>
          <div style="font-size:13px;color:var(--muted);">Move history (mock)</div>
          <div style="width:100%;max-width:760px;height:80px;overflow:auto;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)" id="moveHistory"></div>
        </div>
      </div>
    </section>

    <!-- RESULT SCREEN -->
    <section id="frame-result" class="frame" aria-label="Result">
      <div class="logo-wrap">
        <div class="result" id="resultText">YOU LOSE</div>
        <div class="muted" id="resultDesc">Out of time</div>
      </div>
      <div class="row">
        <button class="btn primary" onclick="showFrame('frame-game-select')">Play Again</button>
        <button class="btn secondary" onclick="showFrame('frame-invite')">Main Menu</button>
      </div>
    </section>

  </div>

<script>
/* -------------------------
   App state + helpers
   ------------------------- */
let activeMode = null; // 'quick' or 'classic'
let currentTurn = 'white'; // 'white' is the local player, 'black' is opponent
let quickTimer = 30;      // seconds remaining in current move (quick)
let classicTime = { white: 600, black: 600 }; // seconds total for classic (10m)
let clockInterval = null;
let moveHistory = [];
let mockOpponent = null;

function showFrame(id){
  document.querySelectorAll('.frame').forEach(f => f.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  stopClock();
}

/* small dim + quick transition (300ms) */
function dimAndGo(btn, target){
  btn.classList.add('dim');
  setTimeout(()=>{ btn.classList.remove('dim'); showFrame(target); }, 300);
}

/* -------------------------
   Intro animation + fanfare
   ------------------------- */
document.getElementById('btnStart').addEventListener('click', (e)=>{
  // small pop animation
  const logo = document.getElementById('logoCircle');
  logo.animate([{ transform: 'scale(.8)' }, { transform: 'scale(1.06)' }, { transform: 'scale(1)' }], { duration: 700, easing: 'cubic-bezier(.2,1,.25,1)' });
  // small fanfare (WebAudio) — will play only on user gesture (start click)
  try{
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const notes = [ 523.25, 659.25, 783.99 ]; // C5 E5 G5 chord
    notes.forEach((freq,i)=>{
      const o = ctx.createOscillator(); const g = ctx.createGain();
      o.type = 'sine'; o.frequency.value = freq; o.connect(g); g.connect(ctx.destination);
      const t = ctx.currentTime + i*0.08;
      g.gain.setValueAtTime(0, t); g.gain.linearRampToValueAtTime(0.12, t+0.02); g.gain.exponentialRampToValueAtTime(0.0001, t+0.22);
      o.start(t); o.stop(t+0.24);
    });
  }catch(e){}
  // go to login after slight delay so animation is seen
  setTimeout(()=> showFrame('frame-login'), 450);
});

/* -------------------------
   Simulated login
   ------------------------- */
document.getElementById('btnSimLogin').addEventListener('click', ()=>{
  // set mock identity
  localStorage.setItem('pi_user', JSON.stringify({ username: 'pioneer123', uid:'uid_01' }));
  // go to invite root
  showFrame('frame-invite');
});

/* -------------------------
   Friends list mock
   ------------------------- */
const sampleFriends = [
  { id:'p1', name:'PlayerOne' },
  { id:'p2', name:'ChessChic' },
  { id:'p3', name:'KnightRider' },
  { id:'p4', name:'QueenBee' },
  { id:'p5', name:'PawnStar' },
];
function renderFriends(){
  const el = document.getElementById('friendsList');
  el.innerHTML = '';
  for(const f of sampleFriends){
    const div = document.createElement('div'); div.className='friend';
    div.innerHTML = `<div><strong>${f.name}</strong><div class="small">uid:${f.id}</div></div><div><input type="checkbox" data-id="${f.id}"></div>`;
    el.appendChild(div);
  }
}
renderFriends();

document.getElementById('btnInviteSelected').addEventListener('click', ()=>{
  // in a real app we'd send invites — here we just go to game select
  const checked = Array.from(document.querySelectorAll('#friendsList input[type=checkbox]')).filter(i=>i.checked).map(i=>i.dataset.id);
  mockOpponent = checked.length ? checked.map(id=> sampleFriends.find(s=>s.id===id).name).join(', ') : 'InvitedFriends';
  // go to game selector
  showFrame('frame-game-select');
});

/* -------------------------
   Leaderboards mock
   ------------------------- */
function renderLeaderboard(kind){
  const area = document.getElementById('leaderboardArea');
  if(kind === 'friends'){
    area.innerHTML = `<strong>Friends Leaderboard</strong><div class="muted">1. PlayerOne — 1500<br>2. KnightRider — 1490<br>3. QueenBee — 1475</div>`;
  } else {
    area.innerHTML = `<strong>Competition Leaderboard</strong><div class="muted">1. GrandMasterX — 2200<br>2. ProPioneer — 2100<br>3. BlitzKing — 1990</div>`;
  }
}

/* -------------------------
   Random opponent + proceed
   ------------------------- */
function mockRandomAndProceed(){
  mockOpponent = 'RandomPioneer_' + Math.floor(Math.random()*999);
  showFrame('frame-game-select');
}

/* -------------------------
   Start match
   ------------------------- */
function startMatch(mode){
  activeMode = mode; // 'quick' | 'classic'
  // set labels
  document.getElementById('opponentName').textContent = mockOpponent || 'RandomPioneer42';
  document.getElementById('boardTitle').textContent = `Match — ${mode === 'quick' ? 'Quick (Blitz)' : 'Classic'}`;
  document.getElementById('matchSub').textContent = `Opponent: ${mockOpponent || 'RandomPioneer42'}`;
  // reset history
  moveHistory = [];
  document.getElementById('moveHistory').textContent = '';
  // prepare board visually
  buildBoard();
  // go to board frame
  showFrame('frame-board');
  // start appropriate clock
  currentTurn = 'white';
  if(mode === 'quick') startQuickTimer();
  else startClassicTimer();
}

/* -------------------------
   Build simple visual chessboard (no rules)
   clicking a square = simulated move
   ------------------------- */
function buildBoard(){
  const board = document.getElementById('chessBoard');
  board.innerHTML = '';
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      const sq = document.createElement('div');
      sq.className = 'square ' + (((r+c)%2===0)?'sq-light':'sq-dark');
      sq.dataset.r = r; sq.dataset.c = c;
      // simple click handler to simulate a move
      sq.addEventListener('click', ()=> simulateMove(`sq${r}${c}`));
      // small placeholder piece visuals on starting ranks (simple)
      if(r===1){
        const p = document.createElement('div'); p.className='piece black'; p.textContent='♟'; sq.appendChild(p);
      } else if(r===6){
        const p = document.createElement('div'); p.className='piece white'; p.textContent='♟'; sq.appendChild(p);
      } else if(r===0 && (c===0||c===7)){
        const p = document.createElement('div'); p.className='piece black'; p.textContent='♜'; sq.appendChild(p);
      } else if(r===7 && (c===0||c===7)){
        const p = document.createElement('div'); p.className='piece white'; p.textContent='♜'; sq.appendChild(p);
      }
      board.appendChild(sq);
    }
  }
}

/* -------------------------
   Quick timer logic (per-move)
   - timer resets to 30 when a move is made by whichever player
   - if timer hits 0 -> that player loses
   ------------------------- */
function startQuickTimer(){
  stopClock();
  quickTimer = 30;
  updateTimersUI();
  clockInterval = setInterval(()=>{
    quickTimer--;
    updateTimersUI();
    if(quickTimer <= 0){
      stopClock();
      // currentTurn failed to move -> lose
      showResult(currentTurn === 'white' ? 'You lose — out of time' : 'Opponent lost — out of time', currentTurn === 'white' ? 'lose' : 'win');
    }
  }, 1000);
}

/* -------------------------
   Classic timer logic (total per player)
   - one clock runs at a time
   - makeMove toggles currentTurn
   - if either total hits 0 -> that side loses
   ------------------------- */
function startClassicTimer(){
  stopClock();
  // initialize if not set
  classicTime.white = classicTime.white || 600;
  classicTime.black = classicTime.black || 600;
  updateTimersUI();
  clockInterval = setInterval(()=>{
    // decrement current player's total
    classicTime[currentTurn]--;
    updateTimersUI();
    if(classicTime[currentTurn] <= 0){
      stopClock();
      showResult(currentTurn === 'white' ? 'You lose — time ran out' : 'Opponent lost — time ran out', currentTurn === 'white' ? 'lose' : 'win');
    }
  },1000);
}

/* Stop any running clock */
function stopClock(){
  if(clockInterval) { clearInterval(clockInterval); clockInterval = null; }
  // reset quick timer color if leaving
  const t = document.getElementById('turnIndicator'); if(t) t.textContent = '▶︎';
}

/* Update clock UI */
function updateTimersUI(){
  const myClock = document.getElementById('myClock'), oppClock = document.getElementById('oppClock'), turnInd = document.getElementById('turnIndicator');
  if(activeMode === 'quick'){
    // show same 30s timer for active player on center display: left/opponent, right/myClock for clarity
    myClock.textContent = (currentTurn === 'white') ? formatSec(quickTimer) : '--';
    oppClock.textContent = (currentTurn === 'black') ? formatSec(quickTimer) : '--';
    // color warning at <=10
    if(quickTimer <= 10){
      if(currentTurn === 'white') myClock.classList.add('red'); else oppClock.classList.add('red');
    } else { myClock.classList.remove('red'); oppClock.classList.remove('red'); }
    turnInd.textContent = currentTurn === 'white' ? 'YOU' : 'OPP';
  } else {
    // classic: show total time per player
    myClock.textContent = formatSec(classicTime.white);
    oppClock.textContent = formatSec(classicTime.black);
    // highlight active (just a small visual)
    turnInd.textContent = (currentTurn === 'white') ? 'YOU' : 'OPP';
    if(classicTime.white <= 60) { myClock.classList.add('red'); } else myClock.classList.remove('red');
    if(classicTime.black <= 60) { oppClock.classList.add('red'); } else oppClock.classList.remove('red');
  }
}

/* format seconds to M:SS or SS */
function formatSec(s){
  if(s === undefined || s === null) return '--';
  if(s >= 60) return Math.floor(s/60) + ':' + String(s%60).padStart(2,'0');
  return String(s).padStart(2,'0');
}

/* -------------------------
   Simulate a move (square click or Make Move)
   - this resets quick timer or toggles classic clocks
   ------------------------- */
function simulateMove(n){
  // record a simple move to history
  moveHistory.unshift((currentTurn==='white' ? 'W':'B') + ' → ' + n);
  updateMoveHistory();
  // apply mode-specific behavior
  if(activeMode === 'quick'){
    // reset quick timer and switch turn
    quickTimer = 30;
    currentTurn = (currentTurn === 'white') ? 'black' : 'white';
    updateTimersUI();
  } else {
    // classic: switch turn - clocks continue counting opposite (we already decrement active tick in interval)
    currentTurn = (currentTurn === 'white') ? 'black' : 'white';
    updateTimersUI();
  }
}

/* Make Move button does the same as clicking a square */
document.getElementById('makeMoveBtn').addEventListener('click', ()=> simulateMove('manualMove'));

/* update move history UI */
function updateMoveHistory(){
  const el = document.getElementById('moveHistory'); el.innerHTML = '';
  moveHistory.slice(0,40).forEach((m,i)=> { const d = document.createElement('div'); d.className = 'muted'; d.textContent = (i+1)+'. '+m; el.appendChild(d); });
}

/* -------------------------
   Resign / Offer Draw (very simple mocks)
   ------------------------- */
document.getElementById('resignBtn').addEventListener('click', ()=> {
  stopClock();
  showResult('You resigned — opponent wins', 'lose');
});
document.getElementById('offerDrawBtn').addEventListener('click', ()=> {
  alert('Draw offered (mock). Opponent auto-declines in this mock.');
});

/* -------------------------
   Show result
   ------------------------- */
function showResult(text, kind){
  document.getElementById('resultText').textContent = (kind === 'win') ? 'YOU WIN' : 'YOU LOSE';
  document.getElementById('resultDesc').textContent = text;
  showFrame('frame-result');
}

/* -------------------------
   Helper: start/stop by mode on show/hide
   ------------------------- */
document.addEventListener('visibilitychange', ()=> {
  // pause clocks if tab hidden to avoid surprises in testing
  if(document.hidden) stopClock();
});

/* -------------------------
   Clean up: return to top flows
   ------------------------- */
function resetAll(){
  activeMode = null;
  currentTurn = 'white';
  quickTimer = 30;
  classicTime.white = 600; classicTime.black = 600;
  moveHistory = [];
  mockOpponent = null;
}
window.showFrame = function(id){
  stopClock();
  if(id === 'frame-invite') {
    // ensure friends/leaderboard are fresh
    renderFriends();
    renderLeaderboard('friends');
  }
  document.querySelectorAll('.frame').forEach(f => f.classList.remove('active'));
  document.getElementById(id).classList.add('active');
};

/* expose some helpers for existing inline buttons */
window.startMatch = startMatch;
window.renderLeaderboard = renderLeaderboard;
window.mockRandomAndProceed = mockRandomAndProceed;
window.simulateMove = simulateMove;

</script>
</body>
</html>
