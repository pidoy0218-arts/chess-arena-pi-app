<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Chess Puzzle - Mate in 3 with Firebase</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard.js/1.0.0/chessboard.min.css"/>
<style>
  body { font-family: sans-serif; background:#111; color:#eee; text-align:center; }
  #board { width: 360px; margin: 20px auto; }
  h2 { margin-top: 20px; }
</style>
</head>
<body>

<h2>Chess Puzzle: Mate in 3</h2>
<div id="board"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>

<script>
  // 🔹 Firebase config - replace with your own
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID",
    measurementId: "YOUR_MEASUREMENT_ID"
  };

  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const analytics = firebase.analytics(app);
</script>

<!-- Chess.js + Chessboard.js via CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard.js/1.0.0/chessboard.min.js"></script>

<script>
  const game = new Chess();

  // 🔹 Mate-in-3 puzzle FEN
  const puzzleFEN = '8/8/8/2k5/8/1Q6/1K6/8 w - - 0 1'; 
  game.load(puzzleFEN);

  // 🔹 Solution moves in SAN notation
  const solution = ['Qa5+', 'Kb7', 'Qb6#']; 
  let step = 0;

  // 🔹 Initialize Chessboard
  const board = Chessboard('board', {
    position: puzzleFEN,
    draggable: true,
    onDrop: (source, target) => {
      const move = game.move({ from: source, to: target, promotion: 'q' });
      if (move === null) return 'snapback';

      board.position(game.fen());

      // ✅ Check correct solution
      if (move.san === solution[step]) {
        step++;
        if (step === solution.length) {
          setTimeout(() => {
            alert('🎉 Mate in 3 solved!');
            firebase.analytics().logEvent('puzzle_solved', {
              puzzle: 'mate_in_3',
              fen: puzzleFEN
            });
          }, 100);
        } else {
          alert('✅ Correct move! Next move.');
        }
      } else {
        alert('❌ Wrong move! Puzzle reset.');
        step = 0;
        game.load(puzzleFEN);
        board.position(puzzleFEN);
      }
    }
  });

  // 🔹 Notify Firebase when puzzle loads
  board.on('ready', () => {
    firebase.analytics().logEvent('puzzle_loaded', {
      puzzle: 'mate_in_3',
      fen: puzzleFEN
    });
  });
</script>

</body>
</html>
