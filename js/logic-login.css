document.addEventListener("DOMContentLoaded", async () => {
  const tapSound = document.getElementById("tapSound");

  if (!window.Pi) {
    alert("Pi Network SDK not available. Please open in Pi Browser.");
    return;
  }

  const loginButton = document.getElementById("loginButton");
  let isLoggingIn = false; // Prevent double trigger

  if (!loginButton) return;

  loginButton.addEventListener("click", async () => {
    if (isLoggingIn) return; // Skip if already clicked
    isLoggingIn = true;

    if (tapSound) {
      tapSound.currentTime = 0; // Reset sound to start
      tapSound.play().catch((e) => {
        console.warn("Sound play blocked or failed:", e);
      });
    }

    try {
      const scopes = ['username'];
      const result = await window.Pi.authenticate(scopes);
      console.log("Authenticated user:", result);
      // Redirect or continue after success
    } catch (error) {
      console.error("Authentication failed:", error);
    }

    setTimeout(() => {
      isLoggingIn = false; // Allow login again after short delay
    }, 2000);
  });
});
